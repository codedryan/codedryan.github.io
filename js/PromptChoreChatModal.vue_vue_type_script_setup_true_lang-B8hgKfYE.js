var k=(_,c,s)=>new Promise((v,l)=>{var b=e=>{try{u(s.next(e))}catch(p){l(p)}},o=e=>{try{u(s.throw(e))}catch(p){l(p)}},u=e=>e.done?v(e.value):Promise.resolve(e.value).then(b,o);u((s=s.apply(_,c)).next())});import{$ as n,U as I}from"./bootstrap-Bf65uz2I.js";import"./css-gf8D6QlL.js";import{E as N}from"./el-dialog-CAR1-R4U.js";import"./el-overlay-Zuw8glOl.js";/* empty css                */import{E as h,a as w}from"./el-form-item-8FQp7Cs4.js";import"./css-C9o_OfXA.js";import{ElInput as R}from"./index-BjDsryRX.js";import{ElButton as g}from"./index-oBOAcXl-.js";import{k as S,r as f,B as E,n as x,E as r,J as i,u as a,p as U,L as y,y as V}from"../jse/index-index-D3Xb8oT_.js";const G=S({__name:"PromptChoreChatModal",emits:["success"],setup(_,{expose:c,emit:s}){const v=s,l=f(!1),b=f(),o=f(),u={title:[{required:!0,message:n("message.required"),trigger:"blur"}]},e=f(!1),p=()=>k(null,null,function*(){e.value=!0;const d={botId:o.value.botId,prompt:o.value.prompt};o.value.prompt="",I.post("/api/v1/bot/prompt/chore/chat",d,{onMessage(t){var C;if(t.event==="done"){e.value=!1;return}if(!t.data)return;const B=(C=JSON.parse(t.data).payload)==null?void 0:C.delta;o.value.prompt+=B}})}),D=()=>{v("success",o.value.prompt),l.value=!1};return c({open(d,t){o.value={botId:d,prompt:t},l.value=!0,p()}}),(d,t)=>(x(),E(a(N),{modelValue:l.value,"onUpdate:modelValue":t[2]||(t[2]=m=>l.value=m),title:a(n)("bot.aiOptimizedPrompts"),draggable:"","align-center":"",width:"550px"},{footer:r(()=>[i(a(g),{onClick:t[1]||(t[1]=m=>l.value=!1)},{default:r(()=>[y(V(a(n)("button.cancel")),1)]),_:1}),e.value?U("",!0):(x(),E(a(g),{key:0,type:"primary",onClick:D},{default:r(()=>[y(V(a(n)("button.replace")),1)]),_:1})),i(a(g),{type:"primary",loading:e.value,disabled:e.value,onClick:p},{default:r(()=>[y(V(e.value?a(n)("button.optimizing"):a(n)("button.regenerate")),1)]),_:1},8,["loading","disabled"])]),default:r(()=>[i(a(h),{ref_key:"formRef",ref:b,model:o.value,rules:u},{default:r(()=>[i(a(w),{prop:"prompt"},{default:r(()=>[i(a(R),{type:"textarea",rows:20,modelValue:o.value.prompt,"onUpdate:modelValue":t[0]||(t[0]=m=>o.value.prompt=m)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]))}});export{G as _};
