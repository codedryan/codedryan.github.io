var z=(E,T,f)=>new Promise((I,s)=>{var O=v=>{try{g(f.next(v))}catch(b){s(b)}},m=v=>{try{g(f.throw(v))}catch(b){s(b)}},g=v=>v.done?I(v.value):Promise.resolve(v.value).then(O,m);g((f=f.apply(E,T)).next())});import{$ as u,X as M,V as Q,bT as R,a8 as te,Y as j,bQ as ne,a3 as oe,M as V,R as d,_ as le}from"./bootstrap-Bf65uz2I.js";import"./css-gf8D6QlL.js";import{E as ae}from"./el-dialog-CAR1-R4U.js";import"./el-overlay-Zuw8glOl.js";import{E as ie,a as se,b as ue}from"./el-dropdown-menu-v2KdT220.js";/* empty css                  *//* empty css                     *//* empty css                */import{E as de,a as K}from"./el-form-item-8FQp7Cs4.js";import"./css-C9o_OfXA.js";import{E as N}from"./el-message-box-B8o3mhYx.js";import{E as me,a as A}from"./el-table-JPhh2aff.js";import"./css-_QzOlLq8.js";/* empty css                   *//* empty css                        *//* empty css               */import{M as re}from"./MagicStaffIcon-BZMW-pVv.js";import{_ as pe}from"./PageData.vue_vue_type_script_setup_true_lang-DfbAOXk_.js";import ce from"./AiContentGeneratorDialog-DrpQgcmO.js";import{ElButton as r}from"./index-oBOAcXl-.js";import{ElInput as S}from"./index-BjDsryRX.js";import{k as fe,r as y,m as _,n as C,J as n,E as a,u as t,q as p,I as ve,y as h,L as k,B as ye,p as L,F as B,N as ge}from"../jse/index-index-D3Xb8oT_.js";import"./index-B3qAv2kq.js";import"./aria-DEUWDJ1E.js";import"./refs-D6FW0B1r.js";import"./event-BB_Ol6Sd.js";import"./index-Bxb6QITi.js";import"./index-Dg3fRnQE.js";import"./vnode-DysYOGZN.js";import"./scroll-C2492Iw_.js";import"./index-CMBjNRIa.js";import"./index-bT9OJj6t.js";import"./_overRest-Bb9G3v08.js";import"./use-form-common-props-IzjzSHax.js";import"./index-CbSmxnRE.js";import"./util-B2mB0_6C.js";import"./castArray-BBset58W.js";import"./_baseClone-trfKWgGN.js";import"./validator-D2YZey62.js";import"./merge-BysAs727.js";import"./isArrayLikeObject-j3RaJGb0.js";import"./_baseSlice-DZe_dRSe.js";import"./_baseIteratee-rJjBrWyx.js";import"./debounce-AsHllEOy.js";import"./toNumber-CvayJyp9.js";import"./index-p7kg-xKH.js";import"./use-form-item-DVWmmqeW.js";import"./omit-CbyqVLxv.js";import"./index-pv0R11Cf.js";import"./raf-BVBe43_O.js";import"./el-empty-CDAlv280.js";import"./el-pagination-W2lJTIgw.js";import"./index-DcZY4wgD.js";import"./index-DGdiZ7pE.js";import"./useProps-DNCnrLfW.js";import"./_baseFindIndex-D7XfJLKM.js";import"./strings-CGsg9AfI.js";import"./index-m1ZP1zbM.js";import"./clamp-CeuJyDnc.js";/* empty css                  */import"./index-C33Sf0pH.js";const Ce={class:"flex w-full flex-col items-start gap-3"},he={class:"flex w-full items-center"},ke={class:"font-medium"},xe={class:"question-container"},_e={class:"flex flex-col gap-2"},Ie={class:"flex gap-1"},be={class:"flex-1"},Qe={class:"question-actions"},Ve={key:1,class:"flex items-center gap-2"},Ee={class:"flex items-center justify-end gap-3"},Te={class:"summary-input-container"},De=`请为以下文本生成一段简短摘要，
要求：
1. 字数控制在50-300字，语言精炼、通俗易懂；
2. 必须涵盖文本的核心主题、关键信息，不添加无关内容；
3. 保持客观中立，不加入个人观点；
4. 摘要为陈述句，结构完整，无语法错误。`,$e=fe({__name:"ChunkDocumentTable",props:{documentId:{type:String,default:""},defaultSummaryPrompt:{type:String,default:""}},setup(E){const T=E,f=y(!1),I=y(),s=y(!1),O=y(),m=y({id:"",summary:"",content:""}),g=y({documentId:T.documentId,sortKey:"sorting",sortType:"asc"}),v=e=>{m.value={summary:e.summary,id:e.id,content:e.content},G()},b=e=>{N.confirm(u("message.deleteAlert"),u("message.noticeTitle"),{confirmButtonText:u("message.ok"),cancelButtonText:u("message.cancel"),type:"warning"}).then(()=>{s.value=!0,V.post("/api/v1/documentChunk/removeChunk",{id:e.id}).then(l=>{if(s.value=!1,l.errorCode!==0){d.error(l.message);return}d.success(u("message.deleteOkMessage")),I.value.setQuery(g.value)})}).catch(()=>{})},G=()=>{f.value=!0},P=()=>{f.value=!1},J=()=>{s.value=!0,V.post("/api/v1/documentChunk/update",m.value).then(e=>{if(s.value=!1,e.errorCode!==0){d.error(e.message);return}d.success(u("message.updateOkMessage")),I.value.setQuery(g.value),P()})},F=e=>{Object.prototype.hasOwnProperty.call(e,"isCollapse")||(e.isCollapse=!1),Object.prototype.hasOwnProperty.call(e,"showAddInput")||(e.showAddInput=!1),Object.prototype.hasOwnProperty.call(e,"newQuestionText")||(e.newQuestionText=""),Object.prototype.hasOwnProperty.call(e,"documentChunkQuestions")||(e.documentChunkQuestions=[]),Object.prototype.hasOwnProperty.call(e,"editIndex")||(e.editIndex=void 0),Object.prototype.hasOwnProperty.call(e,"editId")||(e.editId="")},X=e=>{e.isCollapse=!e.isCollapse},Y=e=>{F(e),e.showAddInput=!0,e.newQuestionText="",e.editIndex=void 0,e.editId=""},D=e=>{if(F(e),!e.newQuestionText.trim()){d.warning("请输入有效的相似提问！");return}const l={question:e.newQuestionText.trim(),documentChunkId:e.id};e.editIndex!==void 0&&e.editId&&(l.id=e.editId);const i=l.id?"/api/v1/documentChunkQuestion/update":"/api/v1/documentChunkQuestion/save";s.value=!0,V.post(i,l).then(o=>{s.value=!1,o.errorCode===0?(d.success(l.id?"更新成功！":"添加成功！"),e.editIndex===void 0?e.documentChunkQuestions.push(l):e.documentChunkQuestions[e.editIndex]=l,e.showAddInput=!1,e.newQuestionText="",e.editIndex=void 0,e.editId=""):d.error(l.id?"更新失败！":`添加失败！${o.message}`)}).catch(o=>{s.value=!1,d.error("网络异常，请重试！"),console.error(o)})},H=e=>{e.editIndex=void 0,e.editId="",e.newQuestionText=""},W=(e,l)=>z(null,null,function*(){try{yield N.confirm("确定要删除这个相似提问吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const i=e.documentChunkQuestions[l].id;if(!i){e.documentChunkQuestions.splice(l,1),d.success("删除成功！");return}s.value=!0,V.post("/api/v1/documentChunkQuestion/remove",{id:i}).then(o=>{s.value=!1,o.errorCode===0?(e.documentChunkQuestions.splice(l,1),d.success("删除成功！")):d.error(`删除失败！${o.message}`)}).catch(o=>{s.value=!1,d.error("网络异常，请重试！"),console.error(o)})}catch(i){d.info("已取消删除")}}),Z=(e,l)=>{F(e);const i=e.documentChunkQuestions[l];e.newQuestionText=i.question,e.editIndex=l,e.editId=i.id||""},q=y(!1),U=y(),w=()=>{V.get(`/api/v1/document/detail?id=${T.documentId}`).then(e=>{e.errorCode===0&&U.value.openDialog(e.data.summaryOptPromptId)}).catch(e=>{console.error(e)})},ee=e=>{m.value.summary=e,q.value=!1};return(e,l)=>(C(),_("div",null,[n(pe,{"page-url":"/api/v1/documentChunk/page",ref_key:"pageDataRef",ref:I,"page-size":10,"extra-query-params":g.value},{default:a(({pageList:i})=>[n(t(me),{data:i,style:{width:"100%"},size:"large"},{default:a(()=>[n(t(A),{prop:"question",label:t(u)("documentCollection.question"),width:"300"},{default:a(({row:o})=>[p("div",Ce,[p("div",he,[p("span",ke,h(o.documentChunkQuestions&&o.documentChunkQuestions.length>0?o.documentChunkQuestions[0].question:"请输入提问"),1),n(t(r),{type:"text",size:"small",onClick:c=>X(o)},{default:a(()=>[k(h(o.isCollapse?"展开":"收起"),1)]),_:2},1032,["onClick"])]),ve(p("div",xe,[p("div",_e,[(C(!0),_(B,null,ge(o.documentChunkQuestions,(c,$)=>(C(),_("div",{key:c.id||$,class:"question-item flex w-full items-center gap-2"},[o.editIndex===$?(C(),_(B,{key:0},[n(t(S),{modelValue:o.newQuestionText,"onUpdate:modelValue":x=>o.newQuestionText=x,placeholder:"请输入相似提问",class:"flex-1",onKeyup:M(x=>D(o),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"]),p("div",Ie,[n(t(r),{type:"primary",size:"small",onClick:x=>D(o),loading:s.value},{default:a(()=>[n(t(Q),null,{default:a(()=>[n(t(R))]),_:1})]),_:1},8,["onClick","loading"]),n(t(r),{size:"small",onClick:x=>H(o)},{default:a(()=>[...l[5]||(l[5]=[k(" 取消 ",-1)])]),_:1},8,["onClick"])])],64)):(C(),_(B,{key:1},[p("span",be,h(c.question),1),p("div",Qe,[n(t(r),{icon:"Edit",type:"text",onClick:x=>Z(o,$)},{default:a(()=>[n(t(Q),null,{default:a(()=>[n(t(te))]),_:1})]),_:1},8,["onClick"]),n(t(r),{icon:"Delete",type:"text",onClick:x=>W(o,$)},{default:a(()=>[n(t(Q),null,{default:a(()=>[n(t(j))]),_:1})]),_:1},8,["onClick"])])],64))]))),128)),!o.showAddInput&&o.editIndex===void 0?(C(),ye(t(r),{key:0,type:"primary",plain:"",size:"small",class:"mt-2 w-fit",onClick:c=>Y(o)},{default:a(()=>[...l[6]||(l[6]=[k(" + 添加相似提问 ",-1)])]),_:1},8,["onClick"])):L("",!0),o.showAddInput&&o.editIndex===void 0?(C(),_("div",Ve,[n(t(S),{modelValue:o.newQuestionText,"onUpdate:modelValue":c=>o.newQuestionText=c,placeholder:"请输入相似提问",class:"flex-1",onKeyup:M(c=>D(o),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"]),n(t(r),{type:"primary",size:"small",onClick:c=>D(o),loading:s.value},{default:a(()=>[n(t(Q),null,{default:a(()=>[n(t(R))]),_:1})]),_:1},8,["onClick","loading"])])):L("",!0)])],512),[[ne,!o.isCollapse]])])]),_:1},8,["label"]),n(t(A),{prop:"summary",label:t(u)("documentCollection.summary")},null,8,["label"]),n(t(A),{prop:"content",label:t(u)("documentCollection.content")},null,8,["label"]),n(t(A),{label:t(u)("common.handle"),width:"100",align:"right"},{default:a(({row:o})=>[p("div",Ee,[n(t(r),{link:"",type:"primary",onClick:c=>v(o)},{default:a(()=>[k(h(t(u)("button.edit")),1)]),_:1},8,["onClick"]),n(t(ie),null,{dropdown:a(()=>[n(t(se),null,{default:a(()=>[n(t(ue),{onClick:c=>b(o)},{default:a(()=>[n(t(r),{link:"",type:"danger",icon:t(j)},{default:a(()=>[k(h(t(u)("button.delete")),1)]),_:1},8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),default:a(()=>[n(t(r),{link:"",icon:t(oe)},null,8,["icon"])]),_:2},1024)])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["extra-query-params"]),n(t(ae),{modelValue:f.value,"onUpdate:modelValue":l[3]||(l[3]=i=>f.value=i),title:t(u)("button.edit"),width:"50%"},{footer:a(()=>[n(t(r),{onClick:P},{default:a(()=>[k(h(t(u)("button.cancel")),1)]),_:1}),n(t(r),{type:"primary",onClick:J,loading:s.value,disabled:s.value},{default:a(()=>[k(h(t(u)("button.save")),1)]),_:1},8,["loading","disabled"])]),default:a(()=>[n(t(de),{ref_key:"basicFormRef",ref:O,style:{width:"100%","margin-top":"20px"},model:m.value},{default:a(()=>[n(t(K),{label:t(u)("documentChunk.summary")},{default:a(()=>[p("div",Te,[n(t(S),{modelValue:m.value.summary,"onUpdate:modelValue":l[0]||(l[0]=i=>m.value.summary=i),rows:5,type:"textarea"},null,8,["modelValue"]),p("button",{onClick:l[1]||(l[1]=i=>w()),type:"button",class:"ai-generate-btn flex items-center gap-0.5 rounded-lg bg-[#F7F7F7] px-3 py-1"},[n(t(Q),{size:"16"},{default:a(()=>[n(re)]),_:1}),l[7]||(l[7]=p("span",{class:"bg-[linear-gradient(106.75666073298856deg,#F17E47,#D85ABF,#717AFF)] bg-clip-text text-sm text-transparent"}," AI生成摘要 ",-1))])])]),_:1},8,["label"]),n(t(K),{label:t(u)("documentChunk.content")},{default:a(()=>[n(t(S),{modelValue:m.value.content,"onUpdate:modelValue":l[2]||(l[2]=i=>m.value.content=i),rows:20,type:"textarea"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),n(ce,{ref_key:"aiSummaryDialogRef",ref:U,modelValue:q.value,"onUpdate:modelValue":l[4]||(l[4]=i=>q.value=i),content:m.value.content,"original-text":m.value.summary,onConfirm:ee,title:"AI生成摘要","modal-title":"AI智能生成摘要","confirm-text":"确认替换摘要","dialog-width":"800","generate-text":"智能摘要","original-text-label":"原始摘要","default-sys-prompt-template-content":E.defaultSummaryPrompt||De},null,8,["modelValue","content","original-text","default-sys-prompt-template-content"])]))}}),zt=le($e,[["__scopeId","data-v-4eb9297e"]]);export{zt as default};
