var ue=Object.defineProperty,pe=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var P=(f,m,r)=>m in f?ue(f,m,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[m]=r,R=(f,m)=>{for(var r in m||(m={}))me.call(m,r)&&P(f,r,m[r]);if(B)for(var r of B(m))ce.call(m,r)&&P(f,r,m[r]);return f},$=(f,m)=>pe(f,de(m));var G=(f,m,r)=>new Promise((u,h)=>{var b=g=>{try{C(r.next(g))}catch(x){h(x)}},U=g=>{try{C(r.throw(g))}catch(x){h(x)}},C=g=>g.done?u(g.value):Promise.resolve(g.value).then(b,U);C((r=r.apply(f,m)).next())});import{as as ve,$ as n,a7 as fe,bQ as A,V as J,bR as ge,Y as M,Z as _e,aI as be,R as O,M as Y,_ as xe}from"./bootstrap-Bf65uz2I.js";import"./css-gf8D6QlL.js";import{E as Z}from"./el-card-DGd_zL6P.js";/* empty css                */import{a as Q,E as ye}from"./el-form-item-8FQp7Cs4.js";import"./css-C9o_OfXA.js";import{E as he}from"./el-pagination-W2lJTIgw.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import{E as H}from"./el-slider-iZWu467N.js";import"./css-B4xXAc0m.js";/* empty css                   */import{E as ke,a as Se}from"./el-steps-CtYXBgXl.js";import"./css-BA5xAVBz.js";import{D as K}from"./DictSelect-DdOvS-6R.js";import{ElButton as E}from"./index-oBOAcXl-.js";import{E as we}from"./index-e0qsk5Ci.js";import{ElInput as L}from"./index-BjDsryRX.js";import{k as Ve,r as S,G as Ce,m as _,n as p,q as t,J as o,E as s,L as w,y as d,u as e,I as j,p as V,F as I,N,B as F}from"../jse/index-index-D3Xb8oT_.js";import"./use-form-common-props-IzjzSHax.js";import"./castArray-BBset58W.js";import"./index-Bxb6QITi.js";import"./_baseClone-trfKWgGN.js";import"./index-DcZY4wgD.js";import"./index-CMBjNRIa.js";import"./index-bT9OJj6t.js";import"./_overRest-Bb9G3v08.js";import"./index-B3qAv2kq.js";import"./aria-DEUWDJ1E.js";import"./index-CbSmxnRE.js";import"./util-B2mB0_6C.js";import"./index-DGdiZ7pE.js";import"./useProps-DNCnrLfW.js";import"./_baseFindIndex-D7XfJLKM.js";import"./_baseIteratee-rJjBrWyx.js";import"./strings-CGsg9AfI.js";import"./use-form-item-DVWmmqeW.js";import"./index-m1ZP1zbM.js";import"./event-BB_Ol6Sd.js";import"./scroll-C2492Iw_.js";import"./clamp-CeuJyDnc.js";import"./toNumber-CvayJyp9.js";import"./index-pv0R11Cf.js";import"./vnode-DysYOGZN.js";import"./index-Dg3fRnQE.js";import"./index-9UPoHQm1.js";import"./index-BKzCwxYe.js";import"./index-C33Sf0pH.js";import"./debounce-AsHllEOy.js";import"./index-DSAOTmKA.js";import"./cloneDeep-Orislllf.js";const ze={class:"imp-doc-kno-container"},Ee={class:"imp-doc-header"},Fe={class:"imp-doc-kno-content"},Qe={class:"rounded-lg bg-[var(--table-header-bg-color)] py-5"},Ie={class:"flex items-center gap-2"},Ne={class:"h-8 w-8 rounded-full bg-[var(--step-item-bg)]"},Ue={class:"text-accent-foreground text-sm/8"},Ae={class:"text-base"},je={class:"mt-6"},qe={class:"flex flex-col items-center"},De={class:"mb-2 text-[16px] font-bold"},Le={class:"text-[14px] text-[var(--el-text-color-secondary)]"},Te={class:"mt-6 flex justify-center"},Be={class:"mt-6"},Pe={class:"answer-div"},Re={class:"mb-1 flex items-center justify-between gap-2"},$e={class:"question-div"},Ge={class:"mb-1 flex items-center justify-between gap-2"},Je={class:"mt-6"},Me={class:"answer-div"},Oe={class:"question-div"},Ye={key:0,class:"flex justify-end"},Ze={class:"mt-6 flex justify-end"},He=Ve({__name:"ImportQA",setup(f){const r=ve().query.datasetId,u=S(0),h=[n("dataset.FileUpload"),n("dataset.ParameterSettings"),n("dataset.GenerateQA"),n("dataset.ConfirmImport")],b=S(!1);function U(){be.back()}const C=S([]),g=S(),x=S([]),q=S([]),c=S({splitFileType:0,spliter:0,chunkSize:512,overlapSize:128,regex:""}),v=Ce({pageNumber:1,pageSize:5,total:0});function W(i){g.value=i}function X(){g.value=null,C.value=[]}function ee(){u.value>0&&u.value--}function te(){return G(this,null,function*(){if(u.value===0&&!g.value){O.warning(n("message.uploadFile"));return}if(u.value===1){b.value=!0;const i=yield ie();if(b.value=!1,i.errorCode===0)x.value=i.data,v.total=x.value.length,D();else return}u.value<h.length-1&&u.value++})}function ae(){const i=x.value.map(a=>$(R({},a),{datasetId:r}));b.value=!0,Y.post("/api/v1/datasetQa/splitSave",i).then(a=>{b.value=!1,a.errorCode===0&&(O.success(a.message),U())})}function le(i){i.questions.push({question:""})}function oe(i){x.value.splice(i,1)}function se(i,a){i.questions.splice(a,1)}function ie(){const i=new FormData;return i.append("file",g.value.raw),i.append("param",JSON.stringify(c.value)),Y.postFile("/api/v1/datasetQa/split",i)}const ne=i=>{v.pageSize=i,v.pageNumber=1,D()},re=i=>{v.pageNumber=i,D()};function D(){q.value=x.value.slice((v.pageNumber-1)*v.pageSize,v.pageNumber*v.pageSize)}return(i,a)=>(p(),_("div",ze,[t("div",Ee,[o(e(E),{onClick:U,icon:e(fe)},{default:s(()=>[w(d(e(n)("button.back")),1)]),_:1},8,["icon"])]),t("div",Fe,[t("div",Qe,[o(e(Se),{active:u.value,"align-center":""},{default:s(()=>[(p(),_(I,null,N(h,(l,k)=>o(e(ke),{key:k},{icon:s(()=>[t("div",Ie,[t("div",Ne,[t("span",Ue,d(k+1),1)]),t("span",Ae,d(l),1)])]),_:2},1024)),64))]),_:1},8,["active"])]),j(t("div",je,[o(e(we),{"file-list":C.value,drag:"",action:"#","auto-upload":!1,"on-change":W,limit:1,"on-remove":X},{default:s(()=>[t("div",qe,[o(e(J),{class:"upload-icon"},{default:s(()=>[o(e(ge))]),_:1}),t("div",De,d(e(n)("message.upload.title")),1),t("div",Le,d(e(n)("message.upload.description")),1)])]),_:1},8,["file-list"])],512),[[A,u.value===0]]),j(t("div",Te,[o(e(ye),{class:"w-[500px]",model:c.value,"label-position":"left","label-width":"100"},{default:s(()=>[o(e(Q),{label:e(n)("dataset.FileType"),prop:"splitFileType"},{default:s(()=>[o(K,{modelValue:c.value.splitFileType,"onUpdate:modelValue":a[0]||(a[0]=l=>c.value.splitFileType=l),"dict-code":"splitFileType"},null,8,["modelValue"])]),_:1},8,["label"]),o(e(Q),{label:e(n)("dataset.Splitter"),prop:"spliter"},{default:s(()=>[o(K,{modelValue:c.value.spliter,"onUpdate:modelValue":a[1]||(a[1]=l=>c.value.spliter=l),"dict-code":"spliter"},null,8,["modelValue"])]),_:1},8,["label"]),[0,1].includes(c.value.spliter)?(p(),F(e(Q),{key:0,label:e(n)("dataset.Length"),prop:"length"},{default:s(()=>[o(e(H),{max:2048,modelValue:c.value.chunkSize,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value.chunkSize=l),"show-input":""},null,8,["modelValue"])]),_:1},8,["label"])):V("",!0),[0,1].includes(c.value.spliter)?(p(),F(e(Q),{key:1,label:e(n)("dataset.ChunkOverlap"),prop:"repeat"},{default:s(()=>[o(e(H),{max:1024,modelValue:c.value.overlapSize,"onUpdate:modelValue":a[3]||(a[3]=l=>c.value.overlapSize=l),"show-input":""},null,8,["modelValue"])]),_:1},8,["label"])):V("",!0),c.value.spliter===2?(p(),F(e(Q),{key:2,label:e(n)("dataset.Regex"),prop:"regex"},{default:s(()=>[o(e(L),{modelValue:c.value.regex,"onUpdate:modelValue":a[4]||(a[4]=l=>c.value.regex=l),placeholder:e(n)("message.enterRegex")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):V("",!0)]),_:1},8,["model"])],512),[[A,u.value===1]]),j(t("div",Be,[o(e(Z),{shadow:"never"},{header:s(()=>[t("div",null,[t("span",null,d(e(n)("dataset.GenerateQA")),1)])]),default:s(()=>[(p(!0),_(I,null,N(q.value,(l,k)=>(p(),_("div",{class:"mt-2 flex",key:k},[t("div",Pe,[t("div",Re,[a[7]||(a[7]=t("span",null,"A:",-1)),o(e(E),{icon:e(M),text:"",type:"danger",onClick:y=>oe(k)},{default:s(()=>[w(d(e(n)("dataset.DeleteQA")),1)]),_:1},8,["icon","onClick"])]),o(e(L),{type:"textarea",rows:4,modelValue:l.answer,"onUpdate:modelValue":y=>l.answer=y},null,8,["modelValue","onUpdate:modelValue"])]),t("div",$e,[t("div",Ge,[a[8]||(a[8]=t("span",null,"Q:",-1)),o(e(E),{icon:e(_e),text:"",type:"primary",onClick:y=>le(l)},{default:s(()=>[w(d(e(n)("dataset.AddQuestion")),1)]),_:1},8,["icon","onClick"])]),(p(!0),_(I,null,N(l.questions,(y,z)=>(p(),_("div",{class:"mb-1 flex items-center gap-1",key:z},[t("span",null,"Q"+d(z+1)+"：",1),o(e(L),{modelValue:y.question,"onUpdate:modelValue":T=>y.question=T},{suffix:s(()=>[o(e(J),{class:"cursor-pointer",onClick:T=>se(l,z)},{default:s(()=>[o(e(M))]),_:1},8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]))),128))]),_:1})],512),[[A,u.value===2]]),j(t("div",Je,[o(e(Z),{shadow:"never"},{header:s(()=>[t("div",null,[t("span",null,d(e(n)("dataset.PreviewQA")),1)])]),default:s(()=>[(p(!0),_(I,null,N(q.value,(l,k)=>(p(),_("div",{class:"flex",key:k},[t("div",Me,[a[9]||(a[9]=t("div",{class:"flex items-center justify-between gap-2"},[t("span",null,"A:")],-1)),w(" "+d(l.answer),1)]),t("div",Oe,[a[10]||(a[10]=t("div",{class:"flex items-center justify-between gap-2"},[t("span",null,"Q:")],-1)),(p(!0),_(I,null,N(l.questions,(y,z)=>(p(),_("div",{class:"mb-1",key:z}," Q"+d(z+1)+"："+d(y.question),1))),128))])]))),128))]),_:1})],512),[[A,u.value===3]]),[2,3].includes(u.value)?(p(),_("div",Ye,[o(e(he),{"current-page":v.pageNumber,"onUpdate:currentPage":a[5]||(a[5]=l=>v.pageNumber=l),"page-size":v.pageSize,"onUpdate:pageSize":a[6]||(a[6]=l=>v.pageSize=l),total:v.total,"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ne,onCurrentChange:re},null,8,["current-page","page-size","total"])])):V("",!0),t("div",Ze,[u.value>0?(p(),F(e(E),{key:0,onClick:ee,loading:b.value},{default:s(()=>[w(d(e(n)("button.previousStep")),1)]),_:1},8,["loading"])):V("",!0),u.value<h.length-1?(p(),F(e(E),{key:1,loading:b.value,type:"primary",onClick:te},{default:s(()=>[w(d(e(n)("button.nextStep")),1)]),_:1},8,["loading"])):V("",!0),u.value===h.length-1?(p(),F(e(E),{key:2,loading:b.value,type:"primary",onClick:ae},{default:s(()=>[w(d(e(n)("dataset.ConfirmImport")),1)]),_:1},8,["loading"])):V("",!0)])])]))}}),Kt=xe(He,[["__scopeId","data-v-a2677dee"]]);export{Kt as default};
