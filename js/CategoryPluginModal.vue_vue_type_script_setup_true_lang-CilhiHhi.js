var I=(E,c,n)=>new Promise((f,d)=>{var v=o=>{try{i(n.next(o))}catch(a){d(a)}},p=o=>{try{i(n.throw(o))}catch(a){d(a)}},i=o=>o.done?f(o.value):Promise.resolve(o.value).then(v,p);i((n=n.apply(E,c)).next())});import{$ as g,M as C,R as P}from"./bootstrap-Bf65uz2I.js";import"./css-gf8D6QlL.js";import{E as D}from"./el-dialog-CAR1-R4U.js";import"./el-overlay-Zuw8glOl.js";/* empty css                */import{E as N,a as $}from"./el-form-item-8FQp7Cs4.js";/* empty css                  *//* empty css               *//* empty css                     *//* empty css                  */import{E as O,a as R}from"./index-DcZY4wgD.js";import{ElButton as k}from"./index-oBOAcXl-.js";import{k as S,r as u,o as T,B as V,n as b,E as r,J as m,u as l,m as U,F as z,N as A,L as x,y as F}from"../jse/index-index-D3Xb8oT_.js";const te=S({__name:"CategoryPluginModal",emits:["reload"],setup(E,{expose:c,emit:n}){const f=n,d=u([]),v=()=>I(null,null,function*(){return C.get("/api/v1/pluginCategory/list").then(e=>{e.errorCode===0&&(d.value=e.data)})});T(()=>{v()}),c({openDialog:h});const p=u(),i=u(!1),o=u(!0),a=u({id:"",categoryIds:[]}),_=u(!1);function M(e){return C.get(`/api/v1/pluginCategoryMapping/getPluginCategories?pluginId=${e}`).then(t=>{t.errorCode===0&&(a.value.categoryIds=t.data)})}function h(e){e.id&&(o.value=!1),M(e.id).then(()=>{a.value.categoryIds=e.categoryIds.map(t=>t.id)}),a.value=e,i.value=!0}function B(){var e;(e=p.value)==null||e.validate(t=>{if(t){const s={pluginId:a.value.id,categoryIds:a.value.categoryIds};C.post("/api/v1/pluginCategoryMapping/updateRelation",s).then(L=>{L.errorCode===0&&(P.success(g("message.updateOkMessage")),y(),f("reload"))})}})}function y(){var e;(e=p.value)==null||e.resetFields(),o.value=!0,a.value={},i.value=!1}return(e,t)=>(b(),V(l(D),{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=s=>i.value=s),draggable:"",width:"500px",title:l(g)("plugin.placeholder.categorize"),"before-close":y,"close-on-click-modal":!1,"align-center":""},{footer:r(()=>[m(l(k),{onClick:y},{default:r(()=>[x(F(l(g)("button.cancel")),1)]),_:1}),m(l(k),{type:"primary",onClick:B,loading:_.value,disabled:_.value},{default:r(()=>[x(F(l(g)("button.save")),1)]),_:1},8,["loading","disabled"])]),default:r(()=>[m(l(N),{ref_key:"saveForm",ref:p,model:a.value,"status-icon":""},{default:r(()=>[m(l($),{prop:"authType",label:l(g)("plugin.category")},{default:r(()=>[m(l(O),{modelValue:a.value.categoryIds,"onUpdate:modelValue":t[0]||(t[0]=s=>a.value.categoryIds=s),multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3},{default:r(()=>[(b(!0),U(z,null,A(d.value,s=>(b(),V(l(R),{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]))}});export{te as _};
