var _e=Object.defineProperty;var ae=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var ie=(v,s,o)=>s in v?_e(v,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):v[s]=o,x=(v,s)=>{for(var o in s||(s={}))ke.call(s,o)&&ie(v,o,s[o]);if(ae)for(var o of ae(s))Me.call(s,o)&&ie(v,o,s[o]);return v};var O=(v,s,o)=>new Promise((f,E)=>{var B=h=>{try{b(o.next(h))}catch(_){E(_)}},y=h=>{try{b(o.throw(h))}catch(_){E(_)}},b=h=>h.done?f(h.value):Promise.resolve(h.value).then(B,y);b((o=o.apply(v,s)).next())});import{M as C,_ as se,$ as i,a8 as Ce,Y as ye,Z as re,V as Z,ax as z,bt as W,R as D}from"./bootstrap-Bf65uz2I.js";import"./css-gf8D6QlL.js";import{a as q,E as G}from"./el-collapse-item-DRoc9NR8.js";/* empty css                */import{a as N,E as Le}from"./el-form-item-8FQp7Cs4.js";import"./css-C9o_OfXA.js";import{E as ne}from"./el-message-box-B8o3mhYx.js";import"./el-overlay-Zuw8glOl.js";import{m as g,n as c,M as Pe,s as me,r as u,o as we,q as p,J as a,u as l,y as M,E as d,L as J,F,N as U,p as Y,B as H}from"../jse/index-index-D3Xb8oT_.js";import{P as xe}from"./PageSide-wLZhy9Oh.js";import Ne from"./AddModelModal-CtX2iZjm.js";import Ve from"./AddModelProviderModal-yr3JKGvl.js";import Ee from"./ManageModelModal--Rq4-Dmo.js";import{i as Be,M as Q,g as De}from"./ModelViewItemOperation-CyWEsQLr.js";import Fe from"./ModelVerifyConfig-DtEOxEWr.js";import{ElInput as V}from"./index-BjDsryRX.js";import{ElButton as X}from"./index-oBOAcXl-.js";import"./event-BB_Ol6Sd.js";import"./castArray-BBset58W.js";import"./index-DF0dk4ce.js";import"./index-Bxb6QITi.js";import"./use-form-common-props-IzjzSHax.js";import"./_baseClone-trfKWgGN.js";import"./index-B3qAv2kq.js";import"./aria-DEUWDJ1E.js";import"./validator-D2YZey62.js";import"./vnode-DysYOGZN.js";import"./scroll-C2492Iw_.js";import"./el-dropdown-menu-v2KdT220.js";import"./index-CMBjNRIa.js";import"./index-bT9OJj6t.js";import"./_overRest-Bb9G3v08.js";import"./index-CbSmxnRE.js";import"./util-B2mB0_6C.js";import"./refs-D6FW0B1r.js";/* empty css                  *//* empty css                     */import"./el-empty-CDAlv280.js";import"./el-dialog-CAR1-R4U.js";import"./index-Dg3fRnQE.js";/* empty css               */import"./model-ability-utils-DYGAejac.js";import"./index-DGdiZ7pE.js";import"./index-C33Sf0pH.js";import"./use-form-item-DVWmmqeW.js";import"./index-m1ZP1zbM.js";/* empty css                  */import"./UploadAvatar-a3x1lqjM.js";import"./el-image-viewer-DlaFkWIK.js";import"./debounce-AsHllEOy.js";import"./toNumber-CvayJyp9.js";import"./css-BA5xAVBz.js";import"./index-e0qsk5Ci.js";import"./cloneDeep-Orislllf.js";import"./providerList-IOY-GpS5.js";import"./index-DcZY4wgD.js";import"./useProps-DNCnrLfW.js";import"./_baseFindIndex-D7XfJLKM.js";import"./_baseIteratee-rJjBrWyx.js";import"./strings-CGsg9AfI.js";import"./clamp-CeuJyDnc.js";import"./index-pv0R11Cf.js";import"./el-tabs-BUyJm6xP.js";import"./use-wheel-C9oFsIdW.js";import"./raf-BVBe43_O.js";import"./index-DSAOTmKA.js";import"./omit-CbyqVLxv.js";import"./_baseSlice-DZe_dRSe.js";/* empty css                   */function de(){return O(this,null,function*(){return C.get("/api/v1/modelProvider/list")})}const Ue={__name:"ManageIcon",props:{className:{type:String,default:""}},setup(v){const s=v;return(o,f)=>(c(),g("svg",{width:"16px",height:"16px",class:me(s.className),viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},[...f[0]||(f[0]=[Pe('<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" data-v-c99bd3c4><g transform="translate(-483, -587)" fill="#FFFFFF" fill-rule="nonzero" data-v-c99bd3c4><g transform="translate(468, 579)" data-v-c99bd3c4><g transform="translate(15, 8)" data-v-c99bd3c4><rect opacity="0" x="0" y="0" width="16" height="16" data-v-c99bd3c4></rect><path d="M2.08296875,4.633625 L13.9143281,4.633625 C14.2234219,4.633625 14.4760625,4.38098438 14.4760625,4.07190625 C14.4760625,3.7628125 14.2261094,3.51015625 13.9143438,3.51015625 L2.08296875,3.51015625 C1.773875,3.51015625 1.52123437,3.7628125 1.52123437,4.07189063 C1.52123437,4.38098438 1.77389062,4.633625 2.08295313,4.633625 L2.08296875,4.633625 Z M13.9143281,7.43960938 L2.08298438,7.43960938 C1.77389063,7.43960938 1.52125,7.69226563 1.52125,8.00134375 C1.52125,8.3104375 1.77390625,8.56307813 2.08296875,8.56307813 L13.9143281,8.56307813 C14.2234219,8.56307813 14.4760625,8.31042188 14.4760625,8.00134375 C14.4760625,7.69225 14.2234063,7.439625 13.9143437,7.439625 L13.9143281,7.43960938 Z M13.9143281,11.366375 L2.08298438,11.366375 C1.77389063,11.366375 1.52125,11.6163281 1.52125,11.9280938 C1.52125,12.2398594 1.77390625,12.4898438 2.08296875,12.4898438 L13.9143281,12.4898438 C14.2234219,12.4898438 14.4760625,12.239875 14.4760625,11.9281094 C14.4760625,11.6163438 14.2234063,11.366375 13.9143437,11.366375 L13.9143281,11.366375 Z" data-v-c99bd3c4></path></g></g></g></g>',1)])],2))}},Ie=se(Ue,[["__scopeId","data-v-c99bd3c4"]]),Re=[{label:i("llmProvider.chatModel"),value:"chatModel"},{label:i("llmProvider.embeddingModel"),value:"embeddingModel"},{label:i("llmProvider.rerankModel"),value:"rerankModel"}],$e={class:"llm-container"},Te={class:"llm-table-container"},Ae={class:"llm-form-container"},Se={class:"title"},je={class:"llm-manage-container"},Ke={key:0},Oe={class:"flex items-center justify-between pr-2"},Ze={key:1},ze={class:"flex items-center justify-between pr-2"},We=["onClick"],qe={key:2},Ge={class:"flex items-center justify-between pr-2"},Je=["onClick"],Ye={class:"model-operation-container"},He={__name:"Model",setup(v){const s=u([]),o=u(""),f=u(""),E=u([]);we(()=>{L()});const B=t=>{!t||t.length===0||t.forEach(e=>{e.icon||(e.icon=De(e.providerType))})},y=u([]),b=u([]),h=u([]),_=t=>{C.get(`/api/v1/model/getList?providerId=${t}&withUsed=true`,{}).then(e=>{if(e.errorCode===0){E.value=e.data,y.value=[],b.value=[];const r=e.data.chatModel||{};y.value=Object.entries(r).map(([k,w])=>({groupName:k,llmList:w}));const K=e.data.embeddingModel||{};b.value=Object.entries(K).map(([k,w])=>({groupName:k,llmList:w}));const n=e.data.rerankModel||{};h.value=Object.entries(n).map(([k,w])=>({groupName:k,llmList:w}))}})},L=()=>{de().then(t=>{s.value=t.data,B(s.value),o.value||(o.value=t.data[0].id,f.value=t.data[0].icon),m.value=x({},t.data[0]),_(o.value)})},I=u({providerName:"",provider:""}),ue=t=>{I.value.providerName=t.providerName,I.value.provider=t.provider,o.value=t.id,f.value=t.icon,m.value=x({},t),_(t.id)},R=u(),ee=u(),te=u(),$=u(),pe=t=>{ne.confirm(i("message.deleteAlert"),i("message.noticeTitle"),{confirmButtonText:i("message.ok"),cancelButtonText:i("message.cancel"),type:"warning"}).then(()=>{C.post("/api/v1/modelProvider/remove",{id:t.id}).then(e=>{e.errorCode===0&&(D.success(e.message),L())})})},m=u({}),ce=u(),le=u(!1),oe=u(!1),ve=[{icon:Ce,label:i("button.edit"),onClick(t){le.value=!0,oe.value=!0;const e=x({},t);Be(e.icon)&&(e.icon=""),R.value.openEditDialog(e)}},{type:"danger",icon:ye,label:i("button.delete"),onClick(t){pe(t)}}],fe={icon:re,label:i("button.add"),onClick(){oe.value=!0,R.value.openAddDialog(),le.value=!1}},he=t=>{$.value.openAddDialog(t)},ge=t=>{ee.value.openDialog(o.value,t)},T=t=>{ne.confirm(i("message.deleteAlert"),i("message.noticeTitle"),{confirmButtonText:i("message.ok"),cancelButtonText:i("message.cancel"),type:"warning"}).then(()=>{C.post("/api/v1/model/remove",{id:t}).then(e=>{e.errorCode===0&&(D.success(i("message.deleteOkMessage")),_(o.value))})})},A=t=>{C.get(`/api/v1/model/detail?id=${t}`).then(e=>{e.errorCode===0&&$.value.openEditDialog(e.data)})},S=t=>{C.post("/api/v1/model/updateByEntity",{providerId:o.value,groupName:t,withUsed:!1}).then(e=>{e.errorCode===0&&_(o.value)})},P=()=>O(null,null,function*(){if(o.value)try{const t=yield C.post("/api/v1/modelProvider/update",{id:o.value,apiKey:m.value.apiKey,endpoint:m.value.endpoint,chatPath:m.value.chatPath,embedPath:m.value.embedPath,rerankPath:m.value.rerankPath});t.errorCode===0?de().then(e=>{s.value=e.data,B(e.data),s.value.forEach(r=>{r.id===o.value&&(m.value=x({},r))})}):D.error(t.message||i("message.updateFail"))}catch(t){D.error(i("message.networkError")),console.error("更新失败:",t)}}),be=()=>{te.value.openDialog(o.value)},j=t=>{C.post("/api/v1/model/update",{id:t,withUsed:!1}).then(e=>{e.errorCode===0&&_(o.value)})};return(t,e)=>(c(),g("div",$e,[p("div",null,[a(xe,{title:l(i)("llm.addProvider"),"label-key":"providerName","value-key":"id",menus:s.value,"control-btns":ve,"footer-button":fe,onChange:ue,"default-selected":o.value,"icon-size":21},null,8,["title","menus","default-selected"])]),p("div",Te,[p("div",Ae,[p("div",Se,M(I.value.providerName),1),a(l(Le),{ref_key:"llmProviderFormRef",ref:ce,model:m.value,"status-icon":"","label-position":"top"},{default:d(()=>[a(l(N),{prop:"apiKey",label:l(i)("llmProvider.apiKey")},{default:d(()=>[a(l(V),{modelValue:m.value.apiKey,"onUpdate:modelValue":e[0]||(e[0]=r=>m.value.apiKey=r),onBlur:P,type:"password","show-password":""},{append:d(()=>[a(l(X),{onClick:be,style:{"background-color":"var(--el-bg-color)",width:"80px",border:"1px solid #f0f0f0","border-radius":"0 8px 8px 0"}},{default:d(()=>[J(M(l(i)("llm.button.test")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(l(N),{prop:"endpoint",label:l(i)("llmProvider.endpoint")},{default:d(()=>[a(l(V),{modelValue:m.value.endpoint,"onUpdate:modelValue":e[1]||(e[1]=r=>m.value.endpoint=r),modelModifiers:{trim:!0},onBlur:P},null,8,["modelValue"])]),_:1},8,["label"]),a(l(N),{prop:"chatPath",label:l(i)("llmProvider.chatPath")},{default:d(()=>[a(l(V),{modelValue:m.value.chatPath,"onUpdate:modelValue":e[2]||(e[2]=r=>m.value.chatPath=r),modelModifiers:{trim:!0},onBlur:P},null,8,["modelValue"])]),_:1},8,["label"]),a(l(N),{prop:"embedPath",label:l(i)("llmProvider.embedPath")},{default:d(()=>[a(l(V),{modelValue:m.value.embedPath,"onUpdate:modelValue":e[3]||(e[3]=r=>m.value.embedPath=r),modelModifiers:{trim:!0},onBlur:P},null,8,["modelValue"])]),_:1},8,["label"]),a(l(N),{prop:"rerankPath",label:l(i)("llmProvider.rerankPath")},{default:d(()=>[a(l(V),{modelValue:m.value.rerankPath,"onUpdate:modelValue":e[4]||(e[4]=r=>m.value.rerankPath=r),modelModifiers:{trim:!0},onBlur:P},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"]),p("div",je,[(c(!0),g(F,null,U(l(Re),(r,K)=>(c(),g("div",{key:r.value,class:"model-container"},[p("div",{class:me(["model-common-title",[K===0?"first-model-title":""]])},M(r.label),3),r.value==="chatModel"&&y.value.length>0?(c(),g("div",Ke,[a(l(G),{"expand-icon-position":"left"},{default:d(()=>[(c(!0),g(F,null,U(y.value,n=>(c(),H(l(q),{key:n.groupName,title:n.groupName,name:n.groupName},{title:d(()=>[p("div",Oe,[p("span",null,M(n.groupName),1),p("span",null,[a(l(Z),{onClick:z(k=>S(n.groupName),["stop"])},{default:d(()=>[a(l(W))]),_:1},8,["onClick"])])])]),default:d(()=>[a(Q,{"llm-list":n.llmList,icon:f.value,onDeleteLlm:T,onEditLlm:A,onUpdateWithUsed:j},null,8,["llm-list","icon"])]),_:2},1032,["title","name"]))),128))]),_:1})])):Y("",!0),r.value==="embeddingModel"&&b.value.length>0?(c(),g("div",Ze,[a(l(G),{"expand-icon-position":"left"},{default:d(()=>[(c(!0),g(F,null,U(b.value,n=>(c(),H(l(q),{key:n.groupName,title:n.groupName,name:n.groupName},{title:d(()=>[p("div",ze,[p("span",null,M(n.groupName),1),p("span",{onClick:z(k=>S(n.groupName),["stop"])},[a(l(Z),null,{default:d(()=>[a(l(W))]),_:1})],8,We)])]),default:d(()=>[a(Q,{"llm-list":n.llmList,icon:f.value,onDeleteLlm:T,onEditLlm:A,onUpdateWithUsed:j},null,8,["llm-list","icon"])]),_:2},1032,["title","name"]))),128))]),_:1})])):Y("",!0),r.value==="rerankModel"&&b.value.length>0?(c(),g("div",qe,[a(l(G),{"expand-icon-position":"left"},{default:d(()=>[(c(!0),g(F,null,U(h.value,n=>(c(),H(l(q),{key:n.groupName,title:n.groupName,name:n.groupName},{title:d(()=>[p("div",Ge,[p("span",null,M(n.groupName),1),p("span",{onClick:z(k=>S(n.groupName),["stop"])},[a(l(Z),null,{default:d(()=>[a(l(W))]),_:1})],8,Je)])]),default:d(()=>[a(Q,{"llm-list":n.llmList,icon:f.value,onDeleteLlm:T,onEditLlm:A,onUpdateWithUsed:j},null,8,["llm-list","icon"])]),_:2},1032,["title","name"]))),128))]),_:1})])):Y("",!0),p("div",Ye,[a(l(X),{type:"primary",onClick:n=>ge(r.value),icon:Ie},{default:d(()=>[J(M(l(i)("llm.button.management")),1)]),_:1},8,["onClick"]),a(l(X),{icon:l(re),onClick:n=>he(r.value)},{default:d(()=>[J(M(l(i)("button.add")),1)]),_:1},8,["icon","onClick"])])]))),128))])])]),a(Ve,{ref_key:"addLlmProviderRef",ref:R,onReload:e[5]||(e[5]=r=>L())},null,512),a(Ne,{ref_key:"addLlmRef",ref:$,onReload:e[6]||(e[6]=r=>L()),"provider-id":o.value},null,8,["provider-id"]),a(Ee,{ref_key:"manageLlmRef",ref:ee,onReload:e[7]||(e[7]=r=>L())},null,512),a(Fe,{ref_key:"llmVerifyConfigRef",ref:te},null,512)]))}},vl=se(He,[["__scopeId","data-v-14fb4a46"]]);export{vl as default};
