var Z=Object.defineProperty;var D=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var L=(p,m,s)=>m in p?Z(p,m,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[m]=s,x=(p,m)=>{for(var s in m||(m={}))ee.call(m,s)&&L(p,s,m[s]);if(D)for(var s of D(m))oe.call(m,s)&&L(p,s,m[s]);return p};import{$ as a,M as $,R as le}from"./bootstrap-Bf65uz2I.js";import"./css-gf8D6QlL.js";import{E as te}from"./el-dialog-CAR1-R4U.js";import"./el-overlay-Zuw8glOl.js";/* empty css                */import{E as ie,a as c}from"./el-form-item-8FQp7Cs4.js";import"./css-C9o_OfXA.js";import{E as ae}from"./el-message-box-B8o3mhYx.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import{D as g}from"./DictSelect-DdOvS-6R.js";import{ElInput as U}from"./index-BjDsryRX.js";import{E as ne}from"./index-DcZY4wgD.js";import{ElButton as V}from"./index-oBOAcXl-.js";import{k as de,o as re,r as C,B as K,n as u,E as r,J as i,u as o,m as v,L as b,y,F as k,N as w,p as P,q as E}from"../jse/index-index-D3Xb8oT_.js";const ue={key:0},me={key:1},se={class:"ml-2 mt-2 flex"},fe={key:0},Be=de({__name:"NotificationEventModal",emits:["reload"],setup(p,{expose:m,emit:s}){const T=s;re(()=>{z()}),m({openDialog:O});const q=C(),N=C(!1),M=C(!0),B={deptId:"",eventName:"",modelId:"",workflowId:"",botId:"",status:0,metricConfig:{metrics:[]},notifyConfig:{}},e=C(B),_=C(!1),h=C({eventName:[{required:!0,message:a("message.required"),trigger:"blur"}],status:[{required:!0,message:a("message.required"),trigger:"blur"}]}),F=C([]),A={host:"smtp.qq.com",port:"465",subject:"预警通知",content:"",to:"xxx@qq.com",username:"xxx@qq.com",password:"你的授权码"},j={accessKeyId:"",accessKeySecret:"",signName:"",templateCode:"",phone:"",variables:{}},J={secretId:"",secretKey:"",sdkAppId:"",signName:"",templateId:"",phone:"",variables:{}};function O(n){n.id?M.value=!1:n=B,e.value=n,N.value=!0}function R(){var n;(n=q.value)==null||n.validate(l=>{l&&(_.value=!0,$.post(M.value?"api/v1/notificationEvent/save":"api/v1/notificationEvent/update",e.value).then(t=>{_.value=!1,t.errorCode===0&&(le.success(t.message),T("reload"),S())}).catch(()=>{_.value=!1}))})}function S(){var n;(n=q.value)==null||n.resetFields(),M.value=!0,e.value=x({},B),N.value=!1}function z(){$.get("/api/v1/model/list",{}).then(l=>{l.errorCode===0&&(F.value=l.data)})}function G(n){n==="aliyun"&&(e.value.notifyConfig.providerConfig=x({},j)),n==="tencent"&&(e.value.notifyConfig.providerConfig=x({},J))}function H(n){e.value.notifyConfig={notifyWay:n},n==="email"&&(e.value.notifyConfig.emailConfig=x({},A))}function Q(){e.value.metricConfig.metrics||(e.value.metricConfig.metrics=[]),e.value.metricConfig.metrics.push({metricName:"",condition:"",metricValue:""})}function X(){e.value.notifyConfig.providerConfig.variables||(e.value.notifyConfig.providerConfig.variables={}),ae.prompt(`${a("notificationEvent.variable")}Key`,a("notificationEvent.template")+a("notificationEvent.variable"),{confirmButtonText:a("button.confirm"),cancelButtonText:a("button.cancel")}).then(({value:n})=>{e.value.notifyConfig.providerConfig.variables[n]=""}).catch(()=>{})}function Y(n,l){delete e.value.notifyConfig.providerConfig[n][l]}return(n,l)=>(u(),K(o(te),{modelValue:N.value,"onUpdate:modelValue":l[7]||(l[7]=t=>N.value=t),draggable:"",title:M.value?o(a)("button.add"):o(a)("button.edit"),"before-close":S,"close-on-click-modal":!1},{footer:r(()=>[i(o(V),{onClick:S},{default:r(()=>[b(y(o(a)("button.cancel")),1)]),_:1}),i(o(V),{type:"primary",onClick:R,loading:_.value,disabled:_.value},{default:r(()=>[b(y(o(a)("button.save")),1)]),_:1},8,["loading","disabled"])]),default:r(()=>[i(o(ie),{"label-width":"120px",ref_key:"saveForm",ref:q,model:e.value,"status-icon":"",rules:h.value},{default:r(()=>[i(o(c),{prop:"eventName",label:o(a)("notificationEvent.eventName")},{default:r(()=>[i(o(U),{modelValue:e.value.eventName,"onUpdate:modelValue":l[0]||(l[0]=t=>e.value.eventName=t),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1},8,["label"]),i(o(c),{prop:"modelId",label:o(a)("notificationEvent.modelId")},{default:r(()=>[i(o(ne),{modelValue:e.value.modelId,"onUpdate:modelValue":l[1]||(l[1]=t=>e.value.modelId=t),filterable:"",clearable:"",options:F.value,props:{value:"id",label:"title"}},null,8,["modelValue","options"])]),_:1},8,["label"]),i(o(c),{prop:"workflowId",label:o(a)("notificationEvent.workflowId")},{default:r(()=>[i(g,{modelValue:e.value.workflowId,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value.workflowId=t),modelModifiers:{trim:!0},"dict-code":"aiWorkFlow"},null,8,["modelValue"])]),_:1},8,["label"]),i(o(c),{prop:"botId",label:o(a)("notificationEvent.botId")},{default:r(()=>[i(g,{modelValue:e.value.botId,"onUpdate:modelValue":l[3]||(l[3]=t=>e.value.botId=t),modelModifiers:{trim:!0},"dict-code":"aiBot"},null,8,["modelValue"])]),_:1},8,["label"]),i(o(c),{prop:"status",label:o(a)("notificationEvent.status")},{default:r(()=>[i(g,{modelValue:e.value.status,"onUpdate:modelValue":l[4]||(l[4]=t=>e.value.status=t),modelModifiers:{trim:!0},"dict-code":"yesOrNo"},null,8,["modelValue"])]),_:1},8,["label"]),i(o(c),{prop:"metricConfig",label:o(a)("notificationEvent.metricConfig")},{default:r(()=>[i(o(V),{type:"primary",onClick:Q},{default:r(()=>[b(y(o(a)("button.add")),1)]),_:1}),(u(!0),v(k,null,w(e.value.metricConfig.metrics,(t,d)=>(u(),v("div",{class:"mt-2 flex gap-2",key:d},[i(g,{modelValue:t.metricName,"onUpdate:modelValue":f=>t.metricName=f,modelModifiers:{trim:!0},"dict-code":"metric"},null,8,["modelValue","onUpdate:modelValue"]),i(g,{modelValue:t.condition,"onUpdate:modelValue":f=>t.condition=f,modelModifiers:{trim:!0},"dict-code":"metricCondition"},null,8,["modelValue","onUpdate:modelValue"]),i(o(U),{modelValue:t.metricValue,"onUpdate:modelValue":f=>t.metricValue=f,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"]),i(o(V),{type:"danger",onClick:f=>e.value.metricConfig.metrics.splice(d,1)},{default:r(()=>[b(y(o(a)("button.delete")),1)]),_:1},8,["onClick"])]))),128))]),_:1},8,["label"]),i(o(c),{prop:"notifyConfig",label:o(a)("notificationEvent.notifyConfig")},{default:r(()=>[i(g,{modelValue:e.value.notifyConfig.notifyWay,"onUpdate:modelValue":l[5]||(l[5]=t=>e.value.notifyConfig.notifyWay=t),"dict-code":"notifyWay",onChange:H},null,8,["modelValue"]),e.value.notifyConfig.notifyWay==="email"?(u(),v("div",ue,[(u(!0),v(k,null,w(e.value.notifyConfig.emailConfig,(t,d)=>(u(),v("div",{class:"ml-2 mt-2 flex",key:d},[l[8]||(l[8]=E("div",{class:"mr-1"},"|__",-1)),i(o(U),{modelValue:e.value.notifyConfig.emailConfig[d],"onUpdate:modelValue":f=>e.value.notifyConfig.emailConfig[d]=f,modelModifiers:{trim:!0},placeholder:d.toString()},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])):P("",!0),e.value.notifyConfig.notifyWay==="sms"?(u(),v("div",me,[E("div",se,[l[9]||(l[9]=E("div",{class:"mr-1"},"|__",-1)),i(g,{modelValue:e.value.notifyConfig.smsProvider,"onUpdate:modelValue":l[6]||(l[6]=t=>e.value.notifyConfig.smsProvider=t),"dict-code":"smsProvider",onChange:G},null,8,["modelValue"])]),E("div",null,[(u(!0),v(k,null,w(e.value.notifyConfig.providerConfig,(t,d)=>(u(),v("div",{key:d,class:"ml-2 mt-2 flex"},[l[11]||(l[11]=E("div",{class:"mr-1"},"|____",-1)),d.toString()==="variables"?(u(),v("div",fe,[i(o(V),{type:"primary",onClick:X},{default:r(()=>[b(y(o(a)("button.add")),1)]),_:1}),(u(!0),v(k,null,w(e.value.notifyConfig.providerConfig[d],(f,I)=>(u(),v("div",{class:"ml-2 mt-2 flex gap-2",key:I},[l[10]||(l[10]=E("div",{class:"mr-1"},"|______",-1)),i(o(U),{modelValue:e.value.notifyConfig.providerConfig[d][I],"onUpdate:modelValue":W=>e.value.notifyConfig.providerConfig[d][I]=W,modelModifiers:{trim:!0},placeholder:I.toString()},null,8,["modelValue","onUpdate:modelValue","placeholder"]),i(o(V),{type:"danger",onClick:W=>Y(d,I)},{default:r(()=>[b(y(o(a)("button.delete")),1)]),_:1},8,["onClick"])]))),128))])):(u(),K(o(U),{key:1,modelValue:e.value.notifyConfig.providerConfig[d],"onUpdate:modelValue":f=>e.value.notifyConfig.providerConfig[d]=f,modelModifiers:{trim:!0},placeholder:d.toString()},null,8,["modelValue","onUpdate:modelValue","placeholder"]))]))),128))])])):P("",!0)]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]))}});export{Be as _};
