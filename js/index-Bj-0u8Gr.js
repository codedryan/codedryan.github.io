var st=Object.defineProperty,at=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var Be=(e,t,n)=>t in e?st(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,w=(e,t)=>{for(var n in t||(t={}))Me.call(t,n)&&Be(e,n,t[n]);if(re)for(var n of re(t))Pe.call(t,n)&&Be(e,n,t[n]);return e},P=(e,t)=>at(e,rt(t));var $e=(e,t)=>{var n={};for(var d in e)Me.call(e,d)&&t.indexOf(d)<0&&(n[d]=e[d]);if(e!=null&&re)for(var d of re(e))t.indexOf(d)<0&&Pe.call(e,d)&&(n[d]=e[d]);return n};var ze=(e,t,n)=>new Promise((d,o)=>{var s=r=>{try{l(n.next(r))}catch(p){o(p)}},a=r=>{try{l(n.throw(r))}catch(p){o(p)}},l=r=>r.done?d(r.value):Promise.resolve(r.value).then(s,a);l((n=n.apply(e,t)).next())});import{E as ke,a as _e,s as it}from"./index-DcZY4wgD.js";import{bA as Ce,bp as fe,bs as te,cG as qe,an as ye,ao as G,cm as Ne,cl as lt,bQ as me,ax as $,bD as ct,V as ht,d as ut,aX as ft,bk as pt,bv as yt,bx as z,bB as Nt,bn as ie,br as vt,cI as Ve,aq as Re,di as gt,i as kt}from"./bootstrap-Bf65uz2I.js";import{h as be,b as H,G as ce,d as oe,a8 as He,ai as Ct,aj as mt,A as M,k as W,i as J,x as Ue,P as ne,X as de,r as T,T as q,I as Ee,m as U,n as I,q as Ke,J as ve,B as R,p as Q,E as ge,V as bt,s as B,z as Et,F as Ye,N as Je,w as x,g as Ie,o as Ge,a6 as Kt,y as Dt,c as A,ae as We}from"../jse/index-index-D3Xb8oT_.js";import{E as xt}from"./index-DF0dk4ce.js";import{ElCheckbox as St}from"./index-p7kg-xKH.js";import{E as wt}from"./index-Bpv3aWiu.js";import{a as Tt}from"./use-form-common-props-IzjzSHax.js";import{U as Z}from"./event-BB_Ol6Sd.js";import{p as pe}from"./index-bT9OJj6t.js";import{e as It}from"./strings-CGsg9AfI.js";import"./index-CMBjNRIa.js";import"./index-B3qAv2kq.js";import"./aria-DEUWDJ1E.js";import"./index-Bxb6QITi.js";import"./index-CbSmxnRE.js";import"./util-B2mB0_6C.js";import"./index-DGdiZ7pE.js";import"./useProps-DNCnrLfW.js";import"./_baseFindIndex-D7XfJLKM.js";import"./_baseIteratee-rJjBrWyx.js";import"./_overRest-Bb9G3v08.js";import"./castArray-BBset58W.js";import"./use-form-item-DVWmmqeW.js";import"./index-m1ZP1zbM.js";import"./scroll-C2492Iw_.js";import"./clamp-CeuJyDnc.js";import"./toNumber-CvayJyp9.js";import"./index-pv0R11Cf.js";import"./vnode-DysYOGZN.js";import"./index-Dg3fRnQE.js";import"./omit-CbyqVLxv.js";import"./_baseClone-trfKWgGN.js";import"./_baseSlice-DZe_dRSe.js";const Y="$treeNodeId",Fe=function(e,t){!t||t[Y]||Object.defineProperty(t,Y,{value:e.id,enumerable:!1,configurable:!1,writable:!1})},Oe=(e,t)=>t==null?void 0:t[e||Y],De=(e,t,n)=>{const d=e.value.currentNode;n();const o=e.value.currentNode;d!==o&&t("current-change",o?o.data:null,o)},xe=e=>{let t=!0,n=!0,d=!0;for(let o=0,s=e.length;o<s;o++){const a=e[o];(a.checked!==!0||a.indeterminate)&&(t=!1,a.disabled||(d=!1)),(a.checked!==!1||a.indeterminate)&&(n=!1)}return{all:t,none:n,allWithoutDisable:d,half:!t&&!n}},ee=function(e){if(e.childNodes.length===0||e.loading)return;const{all:t,none:n,half:d}=xe(e.childNodes);t?(e.checked=!0,e.indeterminate=!1):d?(e.checked=!1,e.indeterminate=!0):n&&(e.checked=!1,e.indeterminate=!1);const o=e.parent;!o||o.level===0||e.store.checkStrictly||ee(o)},le=function(e,t){const n=e.store.props,d=e.data||{},o=n[t];if(oe(o))return o(d,e);if(He(o))return d[o];if(te(o)){const s=d[t];return te(s)?"":s}},Se=function(e,t){e.forEach(n=>{n.canFocus=t,Se(n.childNodes,t)})};let Ot=0;class F{constructor(t){this.isLeafByUser=void 0,this.isLeaf=void 0,this.id=Ot++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1,this.canFocus=!1;for(const n in t)be(t,n)&&(this[n]=t[n]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1)}initialize(){var t;const n=this.store;if(!n)throw new Error("[Node]store is required!");n.registerNode(this);const d=n.props;if(d&&typeof d.isLeaf!="undefined"){const a=le(this,"isLeaf");Ce(a)&&(this.isLeafByUser=a)}if(n.lazy!==!0&&this.data?(this.setData(this.data),n.defaultExpandAll&&(this.expanded=!0,this.canFocus=!0)):this.level>0&&n.lazy&&n.defaultExpandAll&&!this.isLeafByUser&&this.expand(),H(this.data)||Fe(this,this.data),!this.data)return;const o=n.defaultExpandedKeys,s=n.key;s&&!fe(this.key)&&o&&o.includes(this.key)&&this.expand(null,n.autoExpandParent),s&&n.currentNodeKey!==void 0&&this.key===n.currentNodeKey&&(n.currentNode=this,n.currentNode.isCurrent=!0),n.lazy&&n._initDefaultCheckedNode(this),this.updateLeafState(),(this.level===1||((t=this.parent)==null?void 0:t.expanded)===!0)&&(this.canFocus=!0)}setData(t){H(t)||Fe(this,t),this.data=t,this.childNodes=[];let n;this.level===0&&H(this.data)?n=this.data:n=le(this,"children")||[];for(let d=0,o=n.length;d<o;d++)this.insertChild({data:n[d]})}get label(){return le(this,"label")}get key(){const t=this.store.key;return this.data?this.data[t]:null}get disabled(){return le(this,"disabled")}get nextSibling(){const t=this.parent;if(t){const n=t.childNodes.indexOf(this);if(n>-1)return t.childNodes[n+1]}return null}get previousSibling(){const t=this.parent;if(t){const n=t.childNodes.indexOf(this);if(n>-1)return n>0?t.childNodes[n-1]:null}return null}contains(t,n=!0){return(this.childNodes||[]).some(d=>d===t||n&&d.contains(t))}remove(){const t=this.parent;t&&t.removeChild(this)}insertChild(t,n,d){if(!t)throw new Error("InsertChild error: child is required.");if(!(t instanceof F)){if(!d){const o=this.getChildren(!0);o!=null&&o.includes(t.data)||(te(n)||n<0?o==null||o.push(t.data):o==null||o.splice(n,0,t.data))}Object.assign(t,{parent:this,store:this.store}),t=ce(new F(t)),t instanceof F&&t.initialize()}t.level=this.level+1,te(n)||n<0?this.childNodes.push(t):this.childNodes.splice(n,0,t),this.updateLeafState()}insertBefore(t,n){let d;n&&(d=this.childNodes.indexOf(n)),this.insertChild(t,d)}insertAfter(t,n){let d;n&&(d=this.childNodes.indexOf(n),d!==-1&&(d+=1)),this.insertChild(t,d)}removeChild(t){const n=this.getChildren()||[],d=n.indexOf(t.data);d>-1&&n.splice(d,1);const o=this.childNodes.indexOf(t);o>-1&&(this.store&&this.store.deregisterNode(t),t.parent=null,this.childNodes.splice(o,1)),this.updateLeafState()}removeChildByData(t){let n=null;for(let d=0;d<this.childNodes.length;d++)if(this.childNodes[d].data===t){n=this.childNodes[d];break}n&&this.removeChild(n)}expand(t,n){const d=()=>{if(n){let o=this.parent;for(;o&&o.level>0;)o.expanded=!0,o=o.parent}this.expanded=!0,t&&t(),Se(this.childNodes,!0)};this.shouldLoadData()?this.loadData(o=>{H(o)&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||ee(this),d())}):d()}doCreateChildren(t,n={}){t.forEach(d=>{this.insertChild(Object.assign({data:d},n),void 0,!0)})}collapse(){this.expanded=!1,Se(this.childNodes,!1)}shouldLoadData(){return!!(this.store.lazy===!0&&this.store.load&&!this.loaded)}updateLeafState(){if(this.store.lazy===!0&&this.loaded!==!0&&typeof this.isLeafByUser!="undefined"){this.isLeaf=this.isLeafByUser;return}const t=this.childNodes;if(!this.store.lazy||this.store.lazy===!0&&this.loaded===!0){this.isLeaf=!t||t.length===0;return}this.isLeaf=!1}setChecked(t,n,d,o){if(this.indeterminate=t==="half",this.checked=t===!0,this.store.checkStrictly)return;if(!(this.shouldLoadData()&&!this.store.checkDescendants)){const{all:a,allWithoutDisable:l}=xe(this.childNodes);!this.isLeaf&&!a&&l&&(this.checked=!1,t=!1);const r=()=>{if(n){const p=this.childNodes;for(let i=0,c=p.length;i<c;i++){const f=p[i];o=o||t!==!1;const N=f.disabled?f.checked:o;f.setChecked(N,n,!0,o)}const{half:u,all:y}=xe(p);y||(this.checked=y,this.indeterminate=u)}};if(this.shouldLoadData()){this.loadData(()=>{r(),ee(this)},{checked:t!==!1});return}else r()}const s=this.parent;!s||s.level===0||d||ee(s)}getChildren(t=!1){if(this.level===0)return this.data;const n=this.data;if(!n)return null;const d=this.store.props;let o="children";return d&&(o=d.children||"children"),te(n[o])&&(n[o]=null),t&&!n[o]&&(n[o]=[]),n[o]}updateChildren(){const t=this.getChildren()||[],n=this.childNodes.map(s=>s.data),d={},o=[];t.forEach((s,a)=>{const l=s[Y];!!l&&n.some(p=>(p==null?void 0:p[Y])===l)?d[l]={index:a,data:s}:o.push({index:a,data:s})}),this.store.lazy||n.forEach(s=>{d[s==null?void 0:s[Y]]||this.removeChildByData(s)}),o.forEach(({index:s,data:a})=>{this.insertChild({data:a},s)}),this.updateLeafState()}loadData(t,n={}){if(this.store.lazy===!0&&this.store.load&&!this.loaded&&(!this.loading||Object.keys(n).length)){this.loading=!0;const d=s=>{this.childNodes=[],this.doCreateChildren(s,n),this.loaded=!0,this.loading=!1,this.updateLeafState(),t&&t.call(this,s)},o=()=>{this.loading=!1};this.store.load(this,d,o)}else t&&t.call(this)}eachNode(t){const n=[this];for(;n.length;){const d=n.shift();n.unshift(...d.childNodes),t(d)}}reInitChecked(){this.store.checkStrictly||ee(this)}}class At{constructor(t){this.lazy=!1,this.checkStrictly=!1,this.autoExpandParent=!1,this.defaultExpandAll=!1,this.checkDescendants=!1,this.currentNode=null,this.currentNodeKey=null;for(const n in t)be(t,n)&&(this[n]=t[n]);this.nodesMap={}}initialize(){if(this.root=new F({data:this.data,store:this}),this.root.initialize(),this.lazy&&this.load){const t=this.load;t(this.root,n=>{this.root.doCreateChildren(n),this._initDefaultCheckedNodes()},Ct)}else this._initDefaultCheckedNodes()}filter(t){const n=this.filterNodeMethod,d=this.lazy,o=function(s){return ze(this,null,function*(){const a=s.root?s.root.childNodes:s.childNodes;for(const[l,r]of a.entries())r.visible=!!(n!=null&&n.call(r,t,r.data,r)),l%80===0&&l>0&&(yield M()),yield o(r);if(!s.visible&&a.length){let l=!0;l=!a.some(r=>r.visible),s.root?s.root.visible=l===!1:s.visible=l===!1}t&&s.visible&&!s.isLeaf&&(!d||s.loaded)&&s.expand()})};o(this)}setData(t){t!==this.root.data?(this.nodesMap={},this.root.setData(t),this._initDefaultCheckedNodes(),this.setCurrentNodeKey(this.currentNodeKey)):this.root.updateChildren()}getNode(t){if(t instanceof F)return t;const n=mt(t)?Oe(this.key,t):t;return this.nodesMap[n]||null}insertBefore(t,n){var d;const o=this.getNode(n);(d=o.parent)==null||d.insertBefore({data:t},o)}insertAfter(t,n){var d;const o=this.getNode(n);(d=o.parent)==null||d.insertAfter({data:t},o)}remove(t){const n=this.getNode(t);n&&n.parent&&(n===this.currentNode&&(this.currentNode=null),n.parent.removeChild(n))}append(t,n){const d=qe(n)?this.root:this.getNode(n);d&&d.insertChild({data:t})}_initDefaultCheckedNodes(){const t=this.defaultCheckedKeys||[],n=this.nodesMap;t.forEach(d=>{const o=n[d];o&&o.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(t){const n=this.defaultCheckedKeys||[];!fe(t.key)&&n.includes(t.key)&&t.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(t){t!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=t,this._initDefaultCheckedNodes())}registerNode(t){const n=this.key;if(!(!t||!t.data))if(!n)this.nodesMap[t.id]=t;else{const d=t.key;fe(d)||(this.nodesMap[d]=t)}}deregisterNode(t){!this.key||!t||!t.data||(t.childNodes.forEach(d=>{this.deregisterNode(d)}),delete this.nodesMap[t.key])}getCheckedNodes(t=!1,n=!1){const d=[],o=function(s){(s.root?s.root.childNodes:s.childNodes).forEach(l=>{(l.checked||n&&l.indeterminate)&&(!t||t&&l.isLeaf)&&d.push(l.data),o(l)})};return o(this),d}getCheckedKeys(t=!1){return this.getCheckedNodes(t).map(n=>(n||{})[this.key])}getHalfCheckedNodes(){const t=[],n=function(d){(d.root?d.root.childNodes:d.childNodes).forEach(s=>{s.indeterminate&&t.push(s.data),n(s)})};return n(this),t}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(t=>(t||{})[this.key])}_getAllNodes(){const t=[],n=this.nodesMap;for(const d in n)be(n,d)&&t.push(n[d]);return t}updateChildren(t,n){const d=this.nodesMap[t];if(!d)return;const o=d.childNodes;for(let s=o.length-1;s>=0;s--){const a=o[s];this.remove(a.data)}for(let s=0,a=n.length;s<a;s++){const l=n[s];this.append(l,d.data)}}_setCheckedKeys(t,n=!1,d){const o=this._getAllNodes().sort((r,p)=>r.level-p.level),s=Object.create(null),a=Object.keys(d);o.forEach(r=>r.setChecked(!1,!1));const l=r=>{r.childNodes.forEach(p=>{var u;s[p.data[t]]=!0,(u=p.childNodes)!=null&&u.length&&l(p)})};for(let r=0,p=o.length;r<p;r++){const u=o[r],y=u.data[t].toString();if(!a.includes(y)){u.checked&&!s[y]&&u.setChecked(!1,!1);continue}if(u.childNodes.length&&l(u),u.isLeaf||this.checkStrictly){u.setChecked(!0,!1);continue}if(u.setChecked(!0,!0),n){u.setChecked(!1,!1);const c=function(f){f.childNodes.forEach(g=>{g.isLeaf||g.setChecked(!1,!1),c(g)})};c(u)}}}setCheckedNodes(t,n=!1){const d=this.key,o={};t.forEach(s=>{o[(s||{})[d]]=!0}),this._setCheckedKeys(d,n,o)}setCheckedKeys(t,n=!1){this.defaultCheckedKeys=t;const d=this.key,o={};t.forEach(s=>{o[s]=!0}),this._setCheckedKeys(d,n,o)}setDefaultExpandedKeys(t){t=t||[],this.defaultExpandedKeys=t,t.forEach(n=>{const d=this.getNode(n);d&&d.expand(null,this.autoExpandParent)})}setChecked(t,n,d){const o=this.getNode(t);o&&o.setChecked(!!n,d)}getCurrentNode(){return this.currentNode}setCurrentNode(t){const n=this.currentNode;n&&(n.isCurrent=!1),this.currentNode=t,this.currentNode.isCurrent=!0}setUserCurrentNode(t,n=!0){var d;const o=t[this.key],s=this.nodesMap[o];this.setCurrentNode(s),n&&this.currentNode&&this.currentNode.level>1&&((d=this.currentNode.parent)==null||d.expand(null,!0))}setCurrentNodeKey(t,n=!0){var d;if(this.currentNodeKey=t,qe(t)){this.currentNode&&(this.currentNode.isCurrent=!1),this.currentNode=null;return}const o=this.getNode(t);o&&(this.setCurrentNode(o),n&&this.currentNode&&this.currentNode.level>1&&((d=this.currentNode.parent)==null||d.expand(null,!0)))}}const Ae="RootTree",Xe="NodeInstance",je="TreeNodeMap",Lt=W({name:"ElTreeNodeContent",props:{node:{type:Object,required:!0},renderContent:Function},setup(e){const t=G("tree"),n=J(Xe),d=J(Ae);return()=>{const o=e.node,{data:s,store:a}=o;return e.renderContent?e.renderContent(ne,{_self:n,node:o,data:s,store:a}):Ue(d.ctx.slots,"default",{node:o,data:s},()=>[ne(wt,{tag:"span",truncated:!0,class:t.be("node","label")},()=>[o.label])])}}});var Bt=ye(Lt,[["__file","tree-node-content.vue"]]);function Qe(e){const t=J(je,null),n={treeNodeExpand:d=>{var o;e.node!==d&&((o=e.node)==null||o.collapse())},children:[]};return t&&t.children.push(n),de(je,n),{broadcastExpanded:d=>{if(e.accordion)for(const o of n.children)o.treeNodeExpand(d)}}}const Ze=Symbol("dragEvents");function Mt({props:e,ctx:t,el$:n,dropIndicator$:d,store:o}){const s=G("tree"),a=T({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null});return de(Ze,{treeNodeDragStart:({event:u,treeNode:y})=>{if(u.dataTransfer){if(oe(e.allowDrag)&&!e.allowDrag(y.node))return u.preventDefault(),!1;u.dataTransfer.effectAllowed="move";try{u.dataTransfer.setData("text/plain","")}catch(i){}a.value.draggingNode=y,t.emit("node-drag-start",y.node,u)}},treeNodeDragOver:({event:u,treeNode:y})=>{if(!u.dataTransfer)return;const i=y,c=a.value.dropNode;c&&c.node.id!==i.node.id&&Ne(c.$el,s.is("drop-inner"));const f=a.value.draggingNode;if(!f||!i)return;let N=!0,g=!0,b=!0,K=!0;oe(e.allowDrop)&&(N=e.allowDrop(f.node,i.node,"prev"),K=g=e.allowDrop(f.node,i.node,"inner"),b=e.allowDrop(f.node,i.node,"next")),u.dataTransfer.dropEffect=g||N||b?"move":"none",(N||g||b)&&(c==null?void 0:c.node.id)!==i.node.id&&(c&&t.emit("node-drag-leave",f.node,c.node,u),t.emit("node-drag-enter",f.node,i.node,u)),N||g||b?a.value.dropNode=i:a.value.dropNode=null,i.node.nextSibling===f.node&&(b=!1),i.node.previousSibling===f.node&&(N=!1),i.node.contains(f.node,!1)&&(g=!1),(f.node===i.node||f.node.contains(i.node))&&(N=!1,g=!1,b=!1);const D=i.$el,C=D.querySelector(`.${s.be("node","content")}`).getBoundingClientRect(),O=n.value.getBoundingClientRect(),_=n.value.scrollTop;let E;const se=N?g?.25:b?.45:1:Number.NEGATIVE_INFINITY,v=b?g?.75:N?.55:0:Number.POSITIVE_INFINITY;let k=-9999;const S=u.clientY-C.top;S<C.height*se?E="before":S>C.height*v?E="after":g?E="inner":E="none";const L=D.querySelector(`.${s.be("node","expand-icon")}`).getBoundingClientRect(),ae=d.value;E==="before"?k=L.top-O.top+_:E==="after"&&(k=L.bottom-O.top+_),ae.style.top=`${k}px`,ae.style.left=`${L.right-O.left}px`,E==="inner"?lt(D,s.is("drop-inner")):Ne(D,s.is("drop-inner")),a.value.showDropIndicator=E==="before"||E==="after",a.value.allowDrop=a.value.showDropIndicator||K,a.value.dropType=E,t.emit("node-drag-over",f.node,i.node,u)},treeNodeDragEnd:u=>{var y,i;const{draggingNode:c,dropType:f,dropNode:N}=a.value;if(u.preventDefault(),u.dataTransfer&&(u.dataTransfer.dropEffect="move"),c!=null&&c.node.data&&N){const g={data:c.node.data};f!=="none"&&c.node.remove(),f==="before"?(y=N.node.parent)==null||y.insertBefore(g,N.node):f==="after"?(i=N.node.parent)==null||i.insertAfter(g,N.node):f==="inner"&&N.node.insertChild(g),f!=="none"&&(o.value.registerNode(g),o.value.key&&c.node.eachNode(b=>{var K;(K=o.value.nodesMap[b.data[o.value.key]])==null||K.setChecked(b.checked,!o.value.checkStrictly)})),Ne(N.$el,s.is("drop-inner")),t.emit("node-drag-end",c.node,N.node,f,u),f!=="none"&&t.emit("node-drop",c.node,N.node,f,u)}c&&!N&&t.emit("node-drag-end",c.node,null,f,u),a.value.showDropIndicator=!1,a.value.draggingNode=null,a.value.dropNode=null,a.value.allowDrop=!0}}),{dragState:a}}const Pt=W({name:"ElTreeNode",components:{ElCollapseTransition:xt,ElCheckbox:St,NodeContent:Bt,ElIcon:ht,Loading:ct},props:{node:{type:F,default:()=>({})},props:{type:Object,default:()=>({})},accordion:Boolean,renderContent:Function,renderAfterExpand:Boolean,showCheckbox:Boolean},emits:["node-expand"],setup(e,t){const n=G("tree"),{broadcastExpanded:d}=Qe(e),o=J(Ae),s=T(!1),a=T(!1),l=T(),r=T(),p=T(),u=J(Ze),y=Ie();de(Xe,y),o||ut("Tree","Can not find node's tree."),e.node.expanded&&(s.value=!0,a.value=!0);const i=o.props.props.children||"children";x(()=>{var v;const k=(v=e.node.data)==null?void 0:v[i];return k&&[...k]},()=>{e.node.updateChildren()}),x(()=>e.node.indeterminate,v=>{N(e.node.checked,v)}),x(()=>e.node.checked,v=>{N(v,e.node.indeterminate)}),x(()=>e.node.childNodes.length,()=>e.node.reInitChecked()),x(()=>e.node.expanded,v=>{M(()=>s.value=v),v&&(a.value=!0)});const c=v=>Oe(o.props.nodeKey,v.data),f=v=>{const k=e.props.class;if(!k)return{};let S;if(oe(k)){const{data:L}=v;S=k(L,v)}else S=k;return He(S)?{[S]:!0}:S},N=(v,k)=>{(l.value!==v||r.value!==k)&&o.ctx.emit("check-change",e.node.data,v,k),l.value=v,r.value=k},g=v=>{De(o.store,o.ctx.emit,()=>{var k;if((k=o==null?void 0:o.props)==null?void 0:k.nodeKey){const L=c(e.node);o.store.value.setCurrentNodeKey(L)}else o.store.value.setCurrentNode(e.node)}),o.currentNode.value=e.node,o.props.expandOnClickNode&&K(),(o.props.checkOnClickNode||e.node.isLeaf&&o.props.checkOnClickLeaf&&e.showCheckbox)&&!e.node.disabled&&D(!e.node.checked),o.ctx.emit("node-click",e.node.data,e.node,y,v)},b=v=>{var k;(k=o.instance.vnode.props)!=null&&k.onNodeContextmenu&&(v.stopPropagation(),v.preventDefault()),o.ctx.emit("node-contextmenu",v,e.node.data,e.node,y)},K=()=>{e.node.isLeaf||(s.value?(o.ctx.emit("node-collapse",e.node.data,e.node,y),e.node.collapse()):e.node.expand(()=>{t.emit("node-expand",e.node.data,e.node,y)}))},D=v=>{e.node.setChecked(v,!(o!=null&&o.props.checkStrictly)),M(()=>{const k=o.store.value;o.ctx.emit("check",e.node.data,{checkedNodes:k.getCheckedNodes(),checkedKeys:k.getCheckedKeys(),halfCheckedNodes:k.getHalfCheckedNodes(),halfCheckedKeys:k.getHalfCheckedKeys()})})};return{ns:n,node$:p,tree:o,expanded:s,childNodeRendered:a,oldChecked:l,oldIndeterminate:r,getNodeKey:c,getNodeClass:f,handleSelectChange:N,handleClick:g,handleContextMenu:b,handleExpandIconClick:K,handleCheckChange:D,handleChildNodeExpand:(v,k,S)=>{d(k),o.ctx.emit("node-expand",v,k,S)},handleDragStart:v=>{o.props.draggable&&u.treeNodeDragStart({event:v,treeNode:e})},handleDragOver:v=>{v.preventDefault(),o.props.draggable&&u.treeNodeDragOver({event:v,treeNode:{$el:p.value,node:e.node}})},handleDrop:v=>{v.preventDefault()},handleDragEnd:v=>{o.props.draggable&&u.treeNodeDragEnd(v)},CaretRight:ft}}});function $t(e,t,n,d,o,s){const a=q("el-icon"),l=q("el-checkbox"),r=q("loading"),p=q("node-content"),u=q("el-tree-node"),y=q("el-collapse-transition");return Ee((I(),U("div",{ref:"node$",class:B([e.ns.b("node"),e.ns.is("expanded",e.expanded),e.ns.is("current",e.node.isCurrent),e.ns.is("hidden",!e.node.visible),e.ns.is("focusable",!e.node.disabled),e.ns.is("checked",!e.node.disabled&&e.node.checked),e.getNodeClass(e.node)]),role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.node.disabled,"aria-checked":e.node.checked,draggable:e.tree.props.draggable,"data-key":e.getNodeKey(e.node),onClick:$(e.handleClick,["stop"]),onContextmenu:e.handleContextMenu,onDragstart:$(e.handleDragStart,["stop"]),onDragover:$(e.handleDragOver,["stop"]),onDragend:$(e.handleDragEnd,["stop"]),onDrop:$(e.handleDrop,["stop"])},[Ke("div",{class:B(e.ns.be("node","content")),style:Et({paddingLeft:(e.node.level-1)*e.tree.props.indent+"px"})},[e.tree.props.icon||e.CaretRight?(I(),R(a,{key:0,class:B([e.ns.be("node","expand-icon"),e.ns.is("leaf",e.node.isLeaf),{expanded:!e.node.isLeaf&&e.expanded}]),onClick:$(e.handleExpandIconClick,["stop"])},{default:ge(()=>[(I(),R(bt(e.tree.props.icon||e.CaretRight)))]),_:1},8,["class","onClick"])):Q("v-if",!0),e.showCheckbox?(I(),R(l,{key:1,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:!!e.node.disabled,onClick:$(()=>{},["stop"]),onChange:e.handleCheckChange},null,8,["model-value","indeterminate","disabled","onClick","onChange"])):Q("v-if",!0),e.node.loading?(I(),R(a,{key:2,class:B([e.ns.be("node","loading-icon"),e.ns.is("loading")])},{default:ge(()=>[ve(r)]),_:1},8,["class"])):Q("v-if",!0),ve(p,{node:e.node,"render-content":e.renderContent},null,8,["node","render-content"])],6),ve(y,null,{default:ge(()=>[!e.renderAfterExpand||e.childNodeRendered?Ee((I(),U("div",{key:0,class:B(e.ns.be("node","children")),role:"group","aria-expanded":e.expanded,onClick:$(()=>{},["stop"])},[(I(!0),U(Ye,null,Je(e.node.childNodes,i=>(I(),R(u,{key:e.getNodeKey(i),"render-content":e.renderContent,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,node:i,accordion:e.accordion,props:e.props,onNodeExpand:e.handleChildNodeExpand},null,8,["render-content","render-after-expand","show-checkbox","node","accordion","props","onNodeExpand"]))),128))],10,["aria-expanded","onClick"])),[[me,e.expanded]]):Q("v-if",!0)]),_:1})],42,["aria-expanded","aria-disabled","aria-checked","draggable","data-key","onClick","onContextmenu","onDragstart","onDragover","onDragend","onDrop"])),[[me,e.node.visible]])}var zt=ye(Pt,[["render",$t],["__file","tree-node.vue"]]);function _t({el$:e},t){const n=G("tree");Ge(()=>{s()}),Kt(()=>{Array.from(e.value.querySelectorAll("input[type=checkbox]")).forEach(l=>{l.setAttribute("tabindex","-1")})});function d(a,l){var r,p;const u=t.value.getNode(a[l].dataset.key);return u.canFocus&&u.visible&&(((r=u.parent)==null?void 0:r.expanded)||((p=u.parent)==null?void 0:p.level)===0)}pt(e,"keydown",a=>{const l=a.target;if(!l.className.includes(n.b("node")))return;const r=yt(a),p=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`)),u=p.indexOf(l);let y;if([z.up,z.down].includes(r)){if(a.preventDefault(),r===z.up){y=u===-1?0:u!==0?u-1:p.length-1;const c=y;for(;!d(p,y);){if(y--,y===c){y=-1;break}y<0&&(y=p.length-1)}}else{y=u===-1?0:u<p.length-1?u+1:0;const c=y;for(;!d(p,y);){if(y++,y===c){y=-1;break}y>=p.length&&(y=0)}}y!==-1&&p[y].focus()}[z.left,z.right].includes(r)&&(a.preventDefault(),l.click());const i=l.querySelector('[type="checkbox"]');[z.enter,z.numpadEnter,z.space].includes(r)&&i&&(a.preventDefault(),i.click())});const s=()=>{var a;if(!e.value)return;const l=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`));Array.from(e.value.querySelectorAll("input[type=checkbox]")).forEach(u=>{u.setAttribute("tabindex","-1")});const p=e.value.querySelectorAll(`.${n.is("checked")}[role=treeitem]`);if(p.length){p[0].setAttribute("tabindex","0");return}(a=l[0])==null||a.setAttribute("tabindex","0")}}const qt={"check-change":(e,t,n)=>e&&Ce(t)&&Ce(n),"current-change":(e,t)=>!0,"node-click":(e,t,n,d)=>e&&t&&d instanceof Event,"node-contextmenu":(e,t,n,d)=>e instanceof Event&&t&&n,"node-collapse":(e,t,n)=>e&&t,"node-expand":(e,t,n)=>e&&t,check:(e,t)=>e&&t,"node-drag-start":(e,t)=>e&&t,"node-drag-end":(e,t,n,d)=>e&&d,"node-drop":(e,t,n,d)=>e&&t&&d,"node-drag-leave":(e,t,n)=>e&&t&&n,"node-drag-enter":(e,t,n)=>e&&t&&n,"node-drag-over":(e,t,n)=>e&&t&&n},Ft=W({name:"ElTree",components:{ElTreeNode:zt},props:{data:{type:ie(Array),default:()=>[]},emptyText:{type:String},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkOnClickLeaf:{type:Boolean,default:!0},checkDescendants:Boolean,autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:{type:ie(Function)},showCheckbox:Boolean,draggable:Boolean,allowDrag:{type:ie(Function)},allowDrop:{type:ie(Function)},props:{type:Object,default:()=>({children:"children",label:"label",disabled:"disabled"})},lazy:Boolean,highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},icon:{type:Nt}},emits:qt,setup(e,t){const{t:n}=vt(),d=G("tree"),o=T(new At({key:e.nodeKey,data:e.data,lazy:e.lazy,props:e.props,load:e.load,currentNodeKey:e.currentNodeKey,checkStrictly:e.checkStrictly,checkDescendants:e.checkDescendants,defaultCheckedKeys:e.defaultCheckedKeys,defaultExpandedKeys:e.defaultExpandedKeys,autoExpandParent:e.autoExpandParent,defaultExpandAll:e.defaultExpandAll,filterNodeMethod:e.filterNodeMethod}));o.value.initialize();const s=T(o.value.root),a=T(null),l=T(null),r=T(null),{broadcastExpanded:p}=Qe(e),{dragState:u}=Mt({props:e,ctx:t,el$:l,dropIndicator$:r,store:o});_t({el$:l},o);const y=Ie(),i=A(()=>{let h=y==null?void 0:y.parent;for(;h;){if(h.type.name==="ElTreeSelect")return!0;h=h.parent}return!1}),c=A(()=>{const{childNodes:h}=s.value;return(!h||h.length===0||h.every(({visible:m})=>!m))&&!i.value});x(()=>e.currentNodeKey,h=>{o.value.setCurrentNodeKey(h!=null?h:null)}),x(()=>e.defaultCheckedKeys,(h,m)=>{Ve(h,m)||o.value.setDefaultCheckedKey(h!=null?h:[])}),x(()=>e.defaultExpandedKeys,h=>{o.value.setDefaultExpandedKeys(h!=null?h:[])}),x(()=>e.data,h=>{o.value.setData(h)},{deep:!0}),x(()=>e.checkStrictly,h=>{o.value.checkStrictly=h});const f=h=>{if(!e.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");o.value.filter(h)},N=h=>Oe(e.nodeKey,h.data),g=h=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");const m=o.value.getNode(h);if(!m)return[];const j=[m.data];let X=m.parent;for(;X&&X!==s.value;)j.push(X.data),X=X.parent;return j.reverse()},b=(h,m)=>o.value.getCheckedNodes(h,m),K=h=>o.value.getCheckedKeys(h),D=()=>{const h=o.value.getCurrentNode();return h?h.data:null},C=()=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");const h=D();return h?h[e.nodeKey]:null},O=(h,m)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");o.value.setCheckedNodes(h,m)},_=(h,m)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");o.value.setCheckedKeys(h,m)},E=(h,m,j)=>{o.value.setChecked(h,m,j)},se=()=>o.value.getHalfCheckedNodes(),v=()=>o.value.getHalfCheckedKeys(),k=(h,m=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");De(o,t.emit,()=>{p(h),o.value.setUserCurrentNode(h,m)})},S=(h=null,m=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");De(o,t.emit,()=>{p(),o.value.setCurrentNodeKey(h,m)})},L=h=>o.value.getNode(h),ae=h=>{o.value.remove(h)},et=(h,m)=>{o.value.append(h,m)},tt=(h,m)=>{o.value.insertBefore(h,m)},nt=(h,m)=>{o.value.insertAfter(h,m)},ot=(h,m,j)=>{p(m),t.emit("node-expand",h,m,j)},dt=(h,m)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");o.value.updateChildren(h,m)};return de(Ae,{ctx:t,props:e,store:o,root:s,currentNode:a,instance:y}),de(Tt,void 0),{ns:d,store:o,root:s,currentNode:a,dragState:u,el$:l,dropIndicator$:r,isEmpty:c,filter:f,getNodeKey:N,getNodePath:g,getCheckedNodes:b,getCheckedKeys:K,getCurrentNode:D,getCurrentKey:C,setCheckedNodes:O,setCheckedKeys:_,setChecked:E,getHalfCheckedNodes:se,getHalfCheckedKeys:v,setCurrentNode:k,setCurrentKey:S,t:n,getNode:L,remove:ae,append:et,insertBefore:tt,insertAfter:nt,handleNodeExpand:ot,updateKeyChildren:dt}}});function jt(e,t,n,d,o,s){const a=q("el-tree-node");return I(),U("div",{ref:"el$",class:B([e.ns.b(),e.ns.is("dragging",!!e.dragState.draggingNode),e.ns.is("drop-not-allow",!e.dragState.allowDrop),e.ns.is("drop-inner",e.dragState.dropType==="inner"),{[e.ns.m("highlight-current")]:e.highlightCurrent}]),role:"tree"},[(I(!0),U(Ye,null,Je(e.root.childNodes,l=>(I(),R(a,{key:e.getNodeKey(l),node:l,props:e.props,accordion:e.accordion,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,"render-content":e.renderContent,onNodeExpand:e.handleNodeExpand},null,8,["node","props","accordion","render-after-expand","show-checkbox","render-content","onNodeExpand"]))),128)),e.isEmpty?(I(),U("div",{key:0,class:B(e.ns.e("empty-block"))},[Ue(e.$slots,"empty",{},()=>{var l;return[Ke("span",{class:B(e.ns.e("empty-text"))},Dt((l=e.emptyText)!=null?l:e.t("el.tree.emptyText")),3)]})],2)):Q("v-if",!0),Ee(Ke("div",{ref:"dropIndicator$",class:B(e.ns.e("drop-indicator"))},null,2),[[me,e.dragState.showDropIndicator]])],2)}var Vt=ye(Ft,[["render",jt],["__file","tree.vue"]]);const we=Re(Vt),Rt=(e,{attrs:t,emit:n},{select:d,tree:o,key:s})=>{const a=G("tree-select");return x(()=>e.data,()=>{e.filterable&&M(()=>{var r,p;(p=o.value)==null||p.filter((r=d.value)==null?void 0:r.states.inputValue)})},{flush:"post"}),P(w(w({},pe(We(e),Object.keys(ke.props))),t),{class:A(()=>t.class),style:A(()=>t.style),"onUpdate:modelValue":r=>n(Z,r),valueKey:s,popperClass:A(()=>{const r=[a.e("popper")];return e.popperClass&&r.push(e.popperClass),r.join(" ")}),filterMethod:(r="")=>{var p;e.filterMethod?e.filterMethod(r):e.remoteMethod?e.remoteMethod(r):(p=o.value)==null||p.filter(r)}})},Ht=W({extends:_e,setup(e,t){const n=_e.setup(e,t);delete n.selectOptionClick;const d=Ie().proxy;return M(()=>{n.select.states.cachedOptions.get(d.value)||n.select.onOptionCreate(d)}),x(()=>t.attrs.visible,o=>{M(()=>{n.states.visible=o})},{immediate:!0}),n},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function Te(e){return e||e===0}function Le(e){return H(e)&&e.length}function V(e){return H(e)?e:Te(e)?[e]:[]}function he(e,t,n,d,o){for(let s=0;s<e.length;s++){const a=e[s];if(t(a,s,e,o))return d?d(a,s,e,o):a;{const l=n(a);if(Le(l)){const r=he(l,t,n,d,a);if(r)return r}}}}function ue(e,t,n,d){for(let o=0;o<e.length;o++){const s=e[o];t(s,o,e,d);const a=n(s);Le(a)&&ue(a,t,n,s)}}const Ut=(e,{attrs:t,slots:n,emit:d},{select:o,tree:s,key:a})=>{x([()=>e.modelValue,s],()=>{e.showCheckbox&&M(()=>{const i=s.value;i&&!Ve(i.getCheckedKeys(),V(e.modelValue))&&i.setCheckedKeys(V(e.modelValue))})},{immediate:!0,deep:!0});const l=A(()=>w({value:a.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf"},e.props)),r=(i,c)=>{var f;const N=l.value[i];return oe(N)?N(c,(f=s.value)==null?void 0:f.getNode(r("value",c))):c[N]},p=V(e.modelValue).map(i=>he(e.data||[],c=>r("value",c)===i,c=>r("children",c),(c,f,N,g)=>g&&r("value",g))).filter(i=>Te(i)),u=A(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const i=[];return ue(e.data.concat(e.cacheData),c=>{const f=r("value",c);i.push({value:f,currentLabel:r("label",c),isDisabled:r("disabled",c)})},c=>r("children",c)),i}),y=()=>{var i;return(i=s.value)==null?void 0:i.getCheckedKeys().filter(c=>{var f;const N=(f=s.value)==null?void 0:f.getNode(c);return!fe(N)&&gt(N.childNodes)})};return P(w(w({},pe(We(e),Object.keys(we.props))),t),{nodeKey:a,expandOnClickNode:A(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:A(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(p):p),renderContent:(i,{node:c,data:f,store:N})=>i(Ht,{value:r("value",f),label:r("label",f),disabled:r("disabled",f),visible:c.visible},e.renderContent?()=>e.renderContent(i,{node:c,data:f,store:N}):n.default?()=>n.default({node:c,data:f,store:N}):void 0),filterNodeMethod:(i,c,f)=>e.filterNodeMethod?e.filterNodeMethod(i,c,f):i?new RegExp(It(i),"i").test(r("label",c)||""):!0,onNodeClick:(i,c,f)=>{var N,g,b,K;if((N=t.onNodeClick)==null||N.call(t,i,c,f),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||c.isLeaf)){if(!r("disabled",i)){const D=(g=o.value)==null?void 0:g.states.options.get(r("value",i));(b=o.value)==null||b.handleOptionSelect(D)}}else e.expandOnClickNode&&f.proxy.handleExpandIconClick();(K=o.value)==null||K.focus()}},onCheck:(i,c)=>{var f;if(!e.showCheckbox)return;const N=r("value",i),g={};ue([s.value.store.root],C=>g[C.key]=C,C=>C.childNodes);const b=c.checkedKeys,K=e.multiple?V(e.modelValue).filter(C=>!(C in g)&&!b.includes(C)):[],D=K.concat(b);if(e.checkStrictly)d(Z,e.multiple?D:D.includes(N)?N:void 0);else if(e.multiple){const C=y();d(Z,K.concat(C))}else{const C=he([i],E=>!Le(r("children",E))&&!r("disabled",E),E=>r("children",E)),O=C?r("value",C):void 0,_=Te(e.modelValue)&&!!he([i],E=>r("value",E)===e.modelValue,E=>r("children",E));d(Z,O===e.modelValue||_?void 0:O)}M(()=>{var C;const O=V(e.modelValue);s.value.setCheckedKeys(O),(C=t.onCheck)==null||C.call(t,i,{checkedKeys:s.value.getCheckedKeys(),checkedNodes:s.value.getCheckedNodes(),halfCheckedKeys:s.value.getHalfCheckedKeys(),halfCheckedNodes:s.value.getHalfCheckedNodes()})}),(f=o.value)==null||f.focus()},onNodeExpand:(i,c,f)=>{var N;(N=t.onNodeExpand)==null||N.call(t,i,c,f),M(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&c.checked){const g={},b=s.value.getCheckedKeys();ue([s.value.store.root],C=>g[C.key]=C,C=>C.childNodes);const K=V(e.modelValue).filter(C=>!(C in g)&&!b.includes(C)),D=y();d(Z,K.concat(D))}})},cacheOptions:u})};var Yt=W({props:{data:{type:Array,default:()=>[]}},setup(e){const t=J(it);return x(()=>e.data,()=>{var n;e.data.forEach(o=>{t.states.cachedOptions.has(o.value)||t.states.cachedOptions.set(o.value,o)});const d=((n=t.selectRef)==null?void 0:n.querySelectorAll("input"))||[];kt&&!Array.from(d).includes(document.activeElement)&&t.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const Jt=W({name:"ElTreeSelect",inheritAttrs:!1,props:P(w(w({},ke.props),we.props),{cacheData:{type:Array,default:()=>[]}}),setup(e,t){const{slots:n,expose:d}=t,o=T(),s=T(),a=A(()=>e.nodeKey||e.valueKey||"value"),l=Rt(e,t,{select:o,tree:s,key:a}),y=Ut(e,t,{select:o,tree:s,key:a}),{cacheOptions:r}=y,p=$e(y,["cacheOptions"]),u=ce({});return d(u),Ge(()=>{Object.assign(u,P(w(w({},pe(s.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"])),pe(o.value,["focus","blur","selectedLabel"])),{treeRef:s.value,selectRef:o.value}))}),()=>ne(ke,ce(P(w({},l),{ref:i=>o.value=i})),P(w({},n),{default:()=>[ne(Yt,{data:r.value}),ne(we,ce(P(w({},p),{ref:i=>s.value=i})))]}))}});var Gt=ye(Jt,[["__file","tree-select.vue"]]);const On=Re(Gt);export{On as ElTreeSelect,On as default};
