var I=(E,C,f)=>new Promise((V,c)=>{var k=s=>{try{d(f.next(s))}catch(u){c(u)}},n=s=>{try{d(f.throw(s))}catch(u){c(u)}},d=s=>s.done?V(s.value):Promise.resolve(s.value).then(k,n);d((f=f.apply(E,C)).next())});import{$ as l,X as P,R as j,M as G}from"./bootstrap-Bf65uz2I.js";import"./css-gf8D6QlL.js";import"./css-_QzOlLq8.js";import"./css-Dv7ceDvX.js";import"./css-C9o_OfXA.js";/* empty css                     *//* empty css                  */import{E as J}from"./el-dialog-CAR1-R4U.js";import"./el-overlay-Zuw8glOl.js";/* empty css                */import{E as X,a as y}from"./el-form-item-8FQp7Cs4.js";/* empty css                  *//* empty css               */import{E as z,a as g}from"./el-table-JPhh2aff.js";/* empty css                   *//* empty css                        */import{D as H}from"./DictSelect-DdOvS-6R.js";import{_ as Q}from"./PreviewConversationModal.vue_vue_type_script_setup_true_lang-Co2Vmm9r.js";import{ElDatePicker as W}from"./index-Dwe-AimY.js";import{E as Z,a as ee}from"./index-DcZY4wgD.js";import{ElInput as ae}from"./index-BjDsryRX.js";import{ElButton as h}from"./index-oBOAcXl-.js";import{ElCheckbox as R}from"./index-p7kg-xKH.js";import{k as le,r as p,G as te,m as q,n as T,J as a,E as r,q as b,u as e,F as U,N as oe,L as v,y as m}from"../jse/index-index-D3Xb8oT_.js";const ne={class:"mb-4 grid grid-cols-2 gap-4"},se={class:"mb-4 grid grid-cols-2 gap-4"},re={class:"mb-4 flex items-center gap-3"},ie={class:"ml-auto text-sm text-gray-500"},de={class:"mb-3 flex items-center gap-2"},ue={class:"flex justify-end gap-2"},Ae=le({__name:"SelectConversationModal",emits:["confirm"],setup(E,{expose:C,emit:f}){const V=f,c=p(!1),k=p(),n=te({botId:"",dateRange:[],title:"",qualityFilter:""}),d=p([]),s=p([]),u=p(!1),_=p(!1),A=[{label:l("dataMark.unmarkedOnly"),value:"unannotated"},{label:l("dataMark.allTopics"),value:"all"},{label:l("dataMark.markedTopics"),value:"annotated"}],x=p(),B=()=>{c.value=!0,D()},M=()=>{c.value=!1,D()},D=()=>{var i;n.botId="",n.dateRange=[],n.qualityFilter="all",n.title="",d.value=[],s.value=[],u.value=!1,_.value=!1,(i=x.value)==null||i.resetFields()},S=()=>I(null,null,function*(){G.get("/api/v1/bot/botConversation/list",{params:n}).then(i=>{d.value=i.data})}),w=()=>{S()},O=()=>{n.dateRange=[],n.title="",n.qualityFilter="all",S()},$=i=>{u.value=i,_.value=!1,s.value=i?d.value.map(o=>o.id):[]},N=i=>{const o=s.value.indexOf(i);o===-1?s.value.push(i):s.value.splice(o,1),F()},F=()=>{const i=s.value.length,o=d.value.length;u.value=i===o&&o>0,_.value=i>0&&i<o},Y=i=>{k.value.openDialog(i)},L=()=>{if(s.value.length===0){j.warning(l("message.selectOneSession"));return}V("confirm",{botId:n.botId,conversationIds:[...s.value],conversationCount:s.value.length===0?void 0:s.value.length}),M()};return C({openDialog:B}),(i,o)=>(T(),q(U,null,[a(e(J),{modelValue:c.value,"onUpdate:modelValue":o[5]||(o[5]=t=>c.value=t),title:e(l)("dataMark.selectSession"),width:"800px","close-on-click-modal":!1,onClose:M},{footer:r(()=>[b("div",ue,[a(e(h),{onClick:M},{default:r(()=>[v(m(e(l)("button.cancel")),1)]),_:1}),a(e(h),{type:"primary",onClick:L},{default:r(()=>[v(m(e(l)("button.confirm")),1)]),_:1})])]),default:r(()=>[a(e(X),{ref_key:"formRef",ref:x,model:n,"label-width":"100px"},{default:r(()=>[b("div",ne,[a(e(y),{label:e(l)("dataMark.selectAssistant"),prop:"botId"},{default:r(()=>[a(H,{modelValue:n.botId,"onUpdate:modelValue":o[0]||(o[0]=t=>n.botId=t),"dict-code":"aiBot"},null,8,["modelValue"])]),_:1},8,["label"]),a(e(y),{label:e(l)("dataMark.selectDate"),prop:"dateRange"},{default:r(()=>[a(e(W),{modelValue:n.dateRange,"onUpdate:modelValue":o[1]||(o[1]=t=>n.dateRange=t),type:"daterange","range-separator":"â†’","start-placeholder":e(l)("dataMark.startDate"),"end-placeholder":e(l)("dataMark.endDate"),style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue","start-placeholder","end-placeholder"])]),_:1},8,["label"])]),b("div",se,[a(e(y),{label:e(l)("dataMark.qualityFilter")},{default:r(()=>[a(e(Z),{modelValue:n.qualityFilter,"onUpdate:modelValue":o[2]||(o[2]=t=>n.qualityFilter=t),style:{width:"100%"}},{default:r(()=>[(T(),q(U,null,oe(A,t=>a(e(ee),{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(e(y),{label:e(l)("dataMark.search")},{default:r(()=>[a(e(ae),{modelValue:n.title,"onUpdate:modelValue":o[3]||(o[3]=t=>n.title=t),placeholder:e(l)("message.searchTopic"),onKeyup:P(w,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),b("div",re,[a(e(h),{type:"primary",onClick:w},{default:r(()=>[v(m(e(l)("dataMark.search")),1)]),_:1}),a(e(h),{onClick:O},{default:r(()=>[v(m(e(l)("button.reset")),1)]),_:1}),b("span",ie,m(e(l)("dataMark.sessionTotal",{number:d.value.length})),1)])]),_:1},8,["model"]),b("div",de,[a(e(R),{modelValue:u.value,"onUpdate:modelValue":o[4]||(o[4]=t=>u.value=t),indeterminate:_.value,onChange:$},{default:r(()=>[v(m(e(l)("button.selectAll")),1)]),_:1},8,["modelValue","indeterminate"])]),a(e(z),{data:d.value,border:"","max-height":"400",onSelectionChange:F},{default:r(()=>[a(e(g),{width:"55"},{default:r(({row:t})=>[a(e(R),{"model-value":s.value.includes(t.id),onChange:K=>N(t.id)},null,8,["model-value","onChange"])]),_:1}),a(e(g),{prop:"title",label:e(l)("dataMark.sessionTitle")},null,8,["label"]),a(e(g),{prop:"user",label:e(l)("dataMark.owner")},{default:r(({row:t})=>[v(m(t.accountId),1)]),_:1},8,["label"]),a(e(g),{prop:"created",label:e(l)("dataMark.createdAt")},null,8,["label"]),a(e(g),{label:e(l)("common.handle"),width:"120",align:"center"},{default:r(({row:t})=>[a(e(h),{type:"primary",link:"",onClick:K=>Y(t)},{default:r(()=>[v(m(e(l)("dataMark.previewSession")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["modelValue","title"]),a(Q,{ref_key:"previewDialog",ref:k},null,512)],64))}});export{Ae as _};
