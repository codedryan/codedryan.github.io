var re=Object.defineProperty,ne=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var X=(s,f,i)=>f in s?re(s,f,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[f]=i,j=(s,f)=>{for(var i in f||(f={}))ue.call(f,i)&&X(s,i,f[i]);if(Q)for(var i of Q(f))me.call(f,i)&&X(s,i,f[i]);return s},I=(s,f)=>ne(s,se(f));import{_ as le,$ as o,M as K,R as de}from"./bootstrap-Bf65uz2I.js";import{E as Y}from"./el-alert-DFDoDStD.js";import"./css-gf8D6QlL.js";import{E as ae}from"./el-dialog-CAR1-R4U.js";import"./el-overlay-Zuw8glOl.js";/* empty css                */import{E as ie,a as P}from"./el-form-item-8FQp7Cs4.js";import"./css-C9o_OfXA.js";import{E as pe}from"./el-card-DGd_zL6P.js";import"./css-CLrSDUNG.js";import{E as ce,a as T}from"./el-table-JPhh2aff.js";import"./css-_QzOlLq8.js";/* empty css                   *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css               */import{a as be,E as U}from"./el-tabs-BUyJm6xP.js";import"./css-B4xXAc0m.js";/* empty css                  */import"./css-BBEQ4fog.js";import"./css-Co2xKw2s.js";import{ElRadioGroup as fe,ElRadio as L}from"./index-C5wmh2tf.js";import{ElInputNumber as G}from"./index-9UPoHQm1.js";import{E as ve,a as ye}from"./index-DcZY4wgD.js";import{k as H,c as O,m as h,n as x,J as a,u as e,E as n,q as V,p as z,L as C,y as p,F as oe,N as te,B as q,r as E,G as ge,o as Ve,H as ke,I as we}from"../jse/index-index-D3Xb8oT_.js";import{ElDivider as Z}from"./index-Ce9mjW49.js";import{ElInput as J}from"./index-BjDsryRX.js";import{ElButton as F}from"./index-oBOAcXl-.js";import{D as W}from"./DictSelect-DdOvS-6R.js";import{_ as xe}from"./WorkflowFormItem.vue_vue_type_script_setup_true_lang-Cr5clR5Y.js";const Ce={class:"crontab-pane"},Ee={class:"radio-line"},je={key:0,class:"radio-line"},Pe={class:"radio-line"},he={class:"text"},$e={class:"text"},Me={class:"text"},Te={class:"radio-line"},Ue={class:"text"},Se={class:"text"},qe={class:"text"},Je={class:"radio-line"},Ne=H({__name:"CronTabPane",props:{modelValue:{type:Object,required:!0},label:{type:String,default:""},min:{type:Number,default:0},max:{type:Number,default:59},aliasMap:{type:Object,default:()=>({})},weekModeCheck:{type:Boolean,default:!1},dayModeCheck:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(s,{emit:f}){const i=s,k=f,g=O({get:()=>i.modelValue.type,set:r=>{k("update:modelValue",I(j({},i.modelValue),{type:r})),k("change",r)}}),t=(r,l)=>{k("update:modelValue",I(j({},i.modelValue),{[r]:l}))},w=O(()=>{const r=[];for(let l=i.min;l<=i.max;l++){const m=i.aliasMap[l]?`${i.aliasMap[l]} (${l})`:`${l}`;r.push({value:l,label:m})}return r});return(r,l)=>(x(),h("div",Ce,[a(e(fe),{class:"cron-radio-group",modelValue:g.value,"onUpdate:modelValue":l[5]||(l[5]=m=>g.value=m)},{default:n(()=>[V("div",Ee,[a(e(L),{value:"every"},{default:n(()=>[C(p(r.$t("cron.Per"))+p(s.label)+" (*)",1)]),_:1})]),s.weekModeCheck||s.dayModeCheck?(x(),h("div",je,[a(e(L),{value:"none"},{default:n(()=>[C(p(r.$t("cron.NotSpecified"))+" (?)",1)]),_:1})])):z("",!0),V("div",Pe,[a(e(L),{value:"loop"},{default:n(()=>[C(p(r.$t("cron.Cycle")),1)]),_:1}),V("span",he,p(r.$t("cron.From")),1),a(e(G),{"model-value":s.modelValue.loopStart,"onUpdate:modelValue":l[0]||(l[0]=m=>t("loopStart",m)),min:s.min,max:s.max,size:"small","controls-position":"right"},null,8,["model-value","min","max"]),V("span",$e,p(s.label)+p(r.$t("cron.StartPer")),1),a(e(G),{"model-value":s.modelValue.loopStep,"onUpdate:modelValue":l[1]||(l[1]=m=>t("loopStep",m)),min:1,max:s.max,size:"small","controls-position":"right"},null,8,["model-value","max"]),V("span",Me,p(s.label)+p(r.$t("cron.ExecuteOnce")),1)]),V("div",Te,[a(e(L),{value:"range"},{default:n(()=>[C(p(r.$t("cron.Rang")),1)]),_:1}),V("span",Ue,p(r.$t("cron.From")),1),a(e(G),{"model-value":s.modelValue.rangeStart,"onUpdate:modelValue":l[2]||(l[2]=m=>t("rangeStart",m)),min:s.min,max:s.max,size:"small","controls-position":"right"},null,8,["model-value","min","max"]),V("span",Se,p(r.$t("cron.To")),1),a(e(G),{"model-value":s.modelValue.rangeEnd,"onUpdate:modelValue":l[3]||(l[3]=m=>t("rangeEnd",m)),min:s.min,max:s.max,size:"small","controls-position":"right"},null,8,["model-value","min","max"]),V("span",qe,p(s.label),1)]),V("div",Je,[a(e(L),{value:"specific"},{default:n(()=>[C(p(r.$t("cron.Specify")),1)]),_:1}),a(e(ve),{"model-value":s.modelValue.specificList,"onUpdate:modelValue":l[4]||(l[4]=m=>t("specificList",m)),multiple:"",placeholder:r.$t("dictSelect.placeholder"),style:{width:"100%","min-width":"200px","margin-left":"10px"},size:"small"},{default:n(()=>[(x(!0),h(oe,null,te(w.value,m=>(x(),q(e(ye),{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["model-value","placeholder"])])]),_:1},8,["modelValue"])]))}}),S=le(Ne,[["__scopeId","data-v-f8c77552"]]),De={class:"cron-generator"},Ie={class:"card-header"},Le={class:"result-area"},Fe={class:"result-row"},_e={class:"preview-table"},Be=H({__name:"CronGenerator",emits:["useCron"],setup(s,{emit:f}){const i=f,k=E("second"),g=(v,d)=>({type:"every",rangeStart:v,rangeEnd:v+1,loopStart:v,loopStep:1,specificList:[]}),t=ge({second:g(0),minute:g(0),hour:g(0),day:I(j({},g(1)),{type:"every"}),month:g(1),week:I(j({},g(1)),{type:"none"})}),w={1:o("common.Sun"),2:o("common.Mon"),3:o("common.Tue"),4:o("common.Wed"),5:o("common.Thu"),6:o("common.Fri"),7:o("common.Sat")},r=v=>{switch(v.type){case"every":return"*";case"loop":return`${v.loopStart}/${v.loopStep}`;case"none":return"?";case"range":return`${v.rangeStart}-${v.rangeEnd}`;case"specific":return v.specificList.length===0?"*":v.specificList.sort((d,c)=>d-c).join(",");default:return"*"}},l=()=>{t.day.type!=="none"&&(t.week.type="none")},m=()=>{t.week.type!=="none"&&(t.day.type="none")},$=O(()=>{const v=r(t.second),d=r(t.minute),c=r(t.hour),D=r(t.day),B=r(t.month),y=r(t.week);return`${v} ${d} ${c} ${D} ${B} ${y}`}),N=O(()=>[{second:r(t.second),minute:r(t.minute),hour:r(t.hour),day:r(t.day),month:r(t.month),week:r(t.week)}]),M=()=>{i("useCron",$.value)},_=E([]);function A(){K.get("/api/v1/sysJob/getNextTimes",{params:{cronExpression:$.value}}).then(v=>{_.value=v.errorCode===0?v.data:[]})}return(v,d)=>(x(),h("div",De,[a(e(pe),{class:"box-card",shadow:"never"},{header:n(()=>[V("div",Ie,[V("span",null,p(e(o)("cron.cronExpressionGenerator")),1)])]),default:n(()=>[a(e(be),{modelValue:k.value,"onUpdate:modelValue":d[6]||(d[6]=c=>k.value=c),type:"border-card"},{default:n(()=>[a(e(U),{label:e(o)("common.Second"),name:"second"},{default:n(()=>[a(S,{modelValue:t.second,"onUpdate:modelValue":d[0]||(d[0]=c=>t.second=c),min:0,max:59,label:e(o)("common.Second")},null,8,["modelValue","label"])]),_:1},8,["label"]),a(e(U),{label:e(o)("common.Min"),name:"minute"},{default:n(()=>[a(S,{modelValue:t.minute,"onUpdate:modelValue":d[1]||(d[1]=c=>t.minute=c),min:0,max:59,label:e(o)("common.Min")},null,8,["modelValue","label"])]),_:1},8,["label"]),a(e(U),{label:e(o)("common.Hour"),name:"hour"},{default:n(()=>[a(S,{modelValue:t.hour,"onUpdate:modelValue":d[2]||(d[2]=c=>t.hour=c),min:0,max:23,label:e(o)("common.Hour")},null,8,["modelValue","label"])]),_:1},8,["label"]),a(e(U),{label:e(o)("common.Day"),name:"day"},{default:n(()=>[a(S,{modelValue:t.day,"onUpdate:modelValue":d[3]||(d[3]=c=>t.day=c),min:1,max:31,label:e(o)("common.Day"),"week-mode-check":"",onChange:l},null,8,["modelValue","label"])]),_:1},8,["label"]),a(e(U),{label:e(o)("common.Month"),name:"month"},{default:n(()=>[a(S,{modelValue:t.month,"onUpdate:modelValue":d[4]||(d[4]=c=>t.month=c),min:1,max:12,label:e(o)("common.Month")},null,8,["modelValue","label"])]),_:1},8,["label"]),a(e(U),{label:e(o)("common.Week"),name:"week"},{default:n(()=>[a(S,{modelValue:t.week,"onUpdate:modelValue":d[5]||(d[5]=c=>t.week=c),min:1,max:7,label:e(o)("common.Week"),"alias-map":w,"day-mode-check":"",onChange:m},null,8,["modelValue","label"])]),_:1},8,["label"])]),_:1},8,["modelValue"]),V("div",Le,[a(e(Z),{"content-position":"left"},{default:n(()=>[C(p(e(o)("cron.GenerateResult")),1)]),_:1}),V("div",Fe,[a(e(J),{modelValue:$.value,"onUpdate:modelValue":d[7]||(d[7]=c=>$.value=c),readonly:"",placeholder:e(o)("cron.CronExpression")},{prepend:n(()=>[C(p(e(o)("cron.CronExpression")),1)]),_:1},8,["modelValue","placeholder"]),a(e(F),{type:"primary",onClick:M,style:{"margin-left":"10px"}},{default:n(()=>[C(p(e(o)("cron.UseThisValue")),1)]),_:1}),a(e(F),{type:"primary",onClick:A,style:{"margin-left":"10px"}},{default:n(()=>[C(p(e(o)("cron.CheckLast5ExecutionTimes")),1)]),_:1})]),V("div",_e,[a(e(ce),{data:N.value,border:"",style:{width:"100%"},size:"small"},{default:n(()=>[a(e(T),{prop:"second",label:e(o)("common.Second")},null,8,["label"]),a(e(T),{prop:"minute",label:e(o)("common.Min")},null,8,["label"]),a(e(T),{prop:"hour",label:e(o)("common.Hour")},null,8,["label"]),a(e(T),{prop:"day",label:e(o)("common.Day")},null,8,["label"]),a(e(T),{prop:"month",label:e(o)("common.Month")},null,8,["label"]),a(e(T),{prop:"week",label:e(o)("common.Week")},null,8,["label"])]),_:1},8,["data"])]),a(e(Z),{"content-position":"left"},{default:n(()=>[C(p(e(o)("cron.Last5ExecutionTimes")),1)]),_:1}),(x(!0),h(oe,null,te(_.value,(c,D)=>(x(),h("div",{key:D},p(c),1))),128))])]),_:1})]))}}),Re=le(Be,[["__scopeId","data-v-910c3288"]]),Ge=H({__name:"CronPicker",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(s,{emit:f}){const i=f,k=E(!1);function g(t){i("update:modelValue",t),k.value=!1}return(t,w)=>(x(),h("div",null,[a(e(ae),{draggable:"",title:"Cron",modelValue:k.value,"onUpdate:modelValue":w[0]||(w[0]=r=>k.value=r),width:"60%"},{default:n(()=>[a(Re,{onUseCron:g})]),_:1},8,["modelValue"]),a(e(F),{class:"mt-2",onClick:w[1]||(w[1]=r=>k.value=!0)},{default:n(()=>[C(p(t.$t("cron.ClickGenerate")),1)]),_:1})]))}}),ee='"param"',xl=H({__name:"SysJobModal",emits:["reload"],setup(s,{expose:f,emit:i}){const k=i;Ve(()=>{}),f({openDialog:A});const g=E(),t=E(!1),w=E(!0),r={deptId:"",jobName:"",jobType:"",jobParams:{workflowParams:{}},cronExpression:"",allowConcurrent:0,misfirePolicy:3,options:"",status:"",remark:""},l=E(r),m=E(!1),$=E({jobName:[{required:!0,message:o("message.required"),trigger:"blur"}],jobType:[{required:!0,message:o("message.required"),trigger:"blur"}],cronExpression:[{required:!0,message:o("message.required"),trigger:"blur"}],allowConcurrent:[{required:!0,message:o("message.required"),trigger:"blur"}],misfirePolicy:[{required:!0,message:o("message.required"),trigger:"blur"}]}),N=E(!1),M=E([]),_=E(j({},$.value));function A(y){y.id?(l.value=j({},y),l.value.jobParams||(l.value.jobParams={}),l.value.jobParams.workflowId&&B(l.value.jobParams.workflowId),w.value=!1):l.value=j({},r),t.value=!0}function v(){var y;(y=g.value)==null||y.validate(u=>{u&&(m.value=!0,K.post(w.value?"api/v1/sysJob/save":"api/v1/sysJob/update",l.value).then(R=>{m.value=!1,R.errorCode===0&&(de.success(R.message),k("reload"),d())}).catch(()=>{m.value=!1}))})}function d(){var y;(y=g.value)==null||y.resetFields(),w.value=!0,l.value=j({},r),M.value=[],t.value=!1}function c(y){M.value=[],l.value.jobParams={workflowParams:{}},y===1&&(l.value.jobParams.workflowParams={})}function D(y){l.value.jobParams.workflowParams={},B(y)}function B(y){N.value=!0,K.get(`/api/v1/workflow/getRunningParameters?id=${y}`).then(u=>{N.value=!1,M.value=u.data.parameters})}return(y,u)=>{const R=ke("loading");return x(),q(e(ae),{modelValue:t.value,"onUpdate:modelValue":u[11]||(u[11]=b=>t.value=b),draggable:"",title:w.value?e(o)("button.add"):e(o)("button.edit"),"before-close":d,"close-on-click-modal":!1},{footer:n(()=>[a(e(F),{onClick:d},{default:n(()=>[C(p(e(o)("button.cancel")),1)]),_:1}),a(e(F),{type:"primary",onClick:v,loading:m.value,disabled:m.value},{default:n(()=>[C(p(e(o)("button.save")),1)]),_:1},8,["loading","disabled"])]),default:n(()=>[we((x(),q(e(ie),{"label-width":"120px",ref_key:"saveForm",ref:g,model:l.value,"status-icon":"",rules:_.value},{default:n(()=>[a(e(P),{prop:"jobName",label:e(o)("sysJob.jobName")},{default:n(()=>[a(e(J),{modelValue:l.value.jobName,"onUpdate:modelValue":u[0]||(u[0]=b=>l.value.jobName=b),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1},8,["label"]),a(e(P),{prop:"cronExpression",label:e(o)("sysJob.cronExpression")},{default:n(()=>[a(e(J),{modelValue:l.value.cronExpression,"onUpdate:modelValue":u[1]||(u[1]=b=>l.value.cronExpression=b),modelModifiers:{trim:!0}},null,8,["modelValue"]),a(Ge,{modelValue:l.value.cronExpression,"onUpdate:modelValue":u[2]||(u[2]=b=>l.value.cronExpression=b)},null,8,["modelValue"])]),_:1},8,["label"]),a(e(P),{prop:"jobType",label:e(o)("sysJob.jobType")},{default:n(()=>[a(W,{modelValue:l.value.jobType,"onUpdate:modelValue":u[3]||(u[3]=b=>l.value.jobType=b),"dict-code":"jobType",onChange:c},null,8,["modelValue"])]),_:1},8,["label"]),l.value.jobType===1?(x(),q(e(P),{key:0,label:e(o)("sysJob.workflow"),prop:"jobParams.workflowId",rules:[{required:!0,message:e(o)("message.required"),trigger:"blur"}]},{default:n(()=>[a(W,{modelValue:l.value.jobParams.workflowId,"onUpdate:modelValue":u[4]||(u[4]=b=>l.value.jobParams.workflowId=b),"dict-code":"aiWorkFlow",onChange:D},null,8,["modelValue"])]),_:1},8,["label","rules"])):z("",!0),a(xe,{"run-params":l.value.jobParams.workflowParams,"onUpdate:runParams":u[5]||(u[5]=b=>l.value.jobParams.workflowParams=b),parameters:M.value,"prop-prefix":"jobParams.workflowParams."},null,8,["run-params","parameters"]),l.value.jobType===2?(x(),q(e(P),{key:1,label:e(o)("sysJob.beanMethod"),prop:"jobParams.beanMethod",rules:[{required:!0,message:e(o)("message.required"),trigger:"blur"}]},{default:n(()=>[a(e(J),{modelValue:l.value.jobParams.beanMethod,"onUpdate:modelValue":u[6]||(u[6]=b=>l.value.jobParams.beanMethod=b)},null,8,["modelValue"]),a(e(Y),{style:{"margin-top":"5px"},title:`${e(o)("sysJob.example")}：sysJobServiceImpl.testParam(${ee},false,299)`},null,8,["title"])]),_:1},8,["label","rules"])):z("",!0),l.value.jobType===3?(x(),q(e(P),{key:2,label:e(o)("sysJob.javaMethod"),prop:"jobParams.javaMethod",rules:[{required:!0,message:e(o)("message.required"),trigger:"blur"}]},{default:n(()=>[a(e(J),{modelValue:l.value.jobParams.javaMethod,"onUpdate:modelValue":u[7]||(u[7]=b=>l.value.jobParams.javaMethod=b)},null,8,["modelValue"]),a(e(Y),{style:{"margin-top":"5px"},title:`${e(o)("sysJob.example")}：tech.aiflowy.job.util.JobUtil.execTest(${ee},1,0.52D,100L)`},null,8,["title"])]),_:1},8,["label","rules"])):z("",!0),a(e(P),{prop:"allowConcurrent",label:e(o)("sysJob.allowConcurrent")},{default:n(()=>[a(W,{modelValue:l.value.allowConcurrent,"onUpdate:modelValue":u[8]||(u[8]=b=>l.value.allowConcurrent=b),"dict-code":"yesOrNo"},null,8,["modelValue"])]),_:1},8,["label"]),a(e(P),{prop:"misfirePolicy",label:e(o)("sysJob.misfirePolicy")},{default:n(()=>[a(W,{modelValue:l.value.misfirePolicy,"onUpdate:modelValue":u[9]||(u[9]=b=>l.value.misfirePolicy=b),"dict-code":"misfirePolicy"},null,8,["modelValue"])]),_:1},8,["label"]),a(e(P),{prop:"remark",label:e(o)("sysJob.remark")},{default:n(()=>[a(e(J),{modelValue:l.value.remark,"onUpdate:modelValue":u[10]||(u[10]=b=>l.value.remark=b),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[R,N.value]])]),_:1},8,["modelValue","title"])}}});export{xl as _};
