var We=Object.defineProperty,Ze=Object.defineProperties;var et=Object.getOwnPropertyDescriptors;var Te=Object.getOwnPropertySymbols;var tt=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var Be=(e,n,o)=>n in e?We(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,ce=(e,n)=>{for(var o in n||(n={}))tt.call(n,o)&&Be(e,o,n[o]);if(Te)for(var o of Te(n))nt.call(n,o)&&Be(e,o,n[o]);return e},re=(e,n)=>Ze(e,et(n));var Le=(e,n,o)=>new Promise((d,i)=>{var v=f=>{try{h(o.next(f))}catch(K){i(K)}},b=f=>{try{h(o.throw(f))}catch(K){i(K)}},h=f=>f.done?d(f.value):Promise.resolve(f.value).then(v,b);h((o=o.apply(e,n)).next())});import{bA as Oe,bm as Ke,bn as U,bB as at,cd as te,ao as Ee,an as Ie,aX as ot,ax as X,V as lt,br as dt,aq as st,$ as ge,M as ct,R as rt,_ as it}from"./bootstrap-Bf65uz2I.js";/* empty css                */import"./css-_QzOlLq8.js";/* empty css                        *//* empty css                     *//* empty css                */import{r as A,g as Ae,w as ae,A as ie,c as $,d as He,O as ut,aj as ht,k as Q,i as Pe,P as ft,m as oe,n as H,q as Y,B as G,p as Ne,J as kt,u as r,E as xe,V as yt,s as J,z as Re,a8 as pt,ah as vt,x as Ct,y as me,X as Me,o as gt,H as Nt,I as mt}from"../jse/index-index-D3Xb8oT_.js";import{ElCheckbox as bt}from"./index-p7kg-xKH.js";import{E as Kt}from"./index-Bpv3aWiu.js";import{F as Et}from"./fixed-size-list-CZoudG9a.js";import{a as xt}from"./use-form-common-props-IzjzSHax.js";const De=Symbol(),Dt={key:-1,level:-1,data:{}};var ne=(e=>(e.KEY="id",e.LABEL="label",e.CHILDREN="children",e.DISABLED="disabled",e.CLASS="",e))(ne||{}),be=(e=>(e.ADD="add",e.DELETE="delete",e))(be||{});const Ve={type:Number,default:26},St=Ke({data:{type:U(Array),default:()=>te([])},emptyText:{type:String},height:{type:Number,default:200},props:{type:U(Object),default:()=>te({children:"children",label:"label",disabled:"disabled",value:"id",class:""})},highlightCurrent:Boolean,showCheckbox:Boolean,defaultCheckedKeys:{type:U(Array),default:()=>te([])},checkStrictly:Boolean,defaultExpandedKeys:{type:U(Array),default:()=>te([])},indent:{type:Number,default:16},itemSize:Ve,icon:{type:at},expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkOnClickLeaf:{type:Boolean,default:!0},currentNodeKey:{type:U([String,Number])},accordion:Boolean,filterMethod:{type:U(Function)},perfMode:{type:Boolean,default:!0},scrollbarAlwaysOn:Boolean}),wt=Ke({node:{type:U(Object),default:()=>te(Dt)},expanded:Boolean,checked:Boolean,indeterminate:Boolean,showCheckbox:Boolean,disabled:Boolean,current:Boolean,hiddenExpandIcon:Boolean,itemSize:Ve}),_t=Ke({node:{type:U(Object),required:!0}}),ze="node-click",Fe="node-drop",$e="node-expand",je="node-collapse",Ue="current-change",qe="check",Xe="check-change",Ye="node-contextmenu",Tt={[ze]:(e,n,o)=>e&&n&&o,[Fe]:(e,n,o)=>e&&n&&o,[$e]:(e,n)=>e&&n,[je]:(e,n)=>e&&n,[Ue]:(e,n)=>e&&n,[qe]:(e,n)=>e&&n,[Xe]:(e,n)=>e&&Oe(n),[Ye]:(e,n,o)=>e&&n&&o},Bt={click:(e,n)=>!!(e&&n),drop:(e,n)=>!!(e&&n),toggle:e=>!!e,check:(e,n)=>e&&Oe(n)};function Lt(e,n){const o=A(new Set),d=A(new Set),{emit:i}=Ae();ae([()=>n.value,()=>e.defaultCheckedKeys],()=>ie(()=>{B(e.defaultCheckedKeys)}),{immediate:!0});const v=()=>{if(!n.value||!e.showCheckbox||e.checkStrictly)return;const{levelTreeNodeMap:a,maxLevel:s}=n.value,u=o.value,y=new Set;for(let g=s-1;g>=1;--g){const D=a.get(g);D&&D.forEach(w=>{const P=w.children;if(P){let L=!0,R=!1;for(const W of P){const q=W.key;if(u.has(q))R=!0;else if(y.has(q)){L=!1,R=!0;break}else L=!1}L?u.add(w.key):R?(y.add(w.key),u.delete(w.key)):(u.delete(w.key),y.delete(w.key))}})}d.value=y},b=a=>o.value.has(a.key),h=a=>d.value.has(a.key),f=(a,s,u=!0,y=!0)=>{const g=o.value,D=(w,P)=>{g[P?be.ADD:be.DELETE](w.key);const L=w.children;!e.checkStrictly&&L&&L.forEach(R=>{R.disabled||D(R,P)})};D(a,s),y&&v(),u&&K(a,s)},K=(a,s)=>{const{checkedNodes:u,checkedKeys:y}=C(),{halfCheckedNodes:g,halfCheckedKeys:D}=p();i(qe,a.data,{checkedKeys:y,checkedNodes:u,halfCheckedKeys:D,halfCheckedNodes:g}),i(Xe,a.data,s)};function T(a=!1){return C(a).checkedKeys}function x(a=!1){return C(a).checkedNodes}function S(){return p().halfCheckedKeys}function l(){return p().halfCheckedNodes}function C(a=!1){const s=[],u=[];if(n!=null&&n.value&&e.showCheckbox){const{treeNodeMap:y}=n.value;o.value.forEach(g=>{const D=y.get(g);D&&(!a||a&&D.isLeaf)&&(u.push(g),s.push(D.data))})}return{checkedKeys:u,checkedNodes:s}}function p(){const a=[],s=[];if(n!=null&&n.value&&e.showCheckbox){const{treeNodeMap:u}=n.value;d.value.forEach(y=>{const g=u.get(y);g&&(s.push(y),a.push(g.data))})}return{halfCheckedNodes:a,halfCheckedKeys:s}}function E(a){o.value.clear(),d.value.clear(),ie(()=>{B(a)})}function k(a,s){if(n!=null&&n.value&&e.showCheckbox){const u=n.value.treeNodeMap.get(a);u&&f(u,s,!1)}}function B(a){if(n!=null&&n.value){const{treeNodeMap:s}=n.value;if(e.showCheckbox&&s&&(a==null?void 0:a.length)>0){for(const u of a){const y=s.get(u);y&&!b(y)&&f(y,!0,!1,!1)}v()}}}return{updateCheckedKeys:v,toggleCheckbox:f,isChecked:b,isIndeterminate:h,getCheckedKeys:T,getCheckedNodes:x,getHalfCheckedKeys:S,getHalfCheckedNodes:l,setChecked:k,setCheckedKeys:E}}function Mt(e,n){const o=A(new Set([])),d=A(new Set([])),i=$(()=>He(e.filterMethod));function v(h){var f;if(!i.value)return;const K=new Set,T=d.value,x=o.value,S=[],l=((f=n.value)==null?void 0:f.treeNodes)||[],C=e.filterMethod;x.clear();function p(E){E.forEach(k=>{S.push(k),C!=null&&C(h,k.data,k)?S.forEach(a=>{K.add(a.key),a.expanded=!0}):(k.expanded=!1,k.isLeaf&&x.add(k.key));const B=k.children;if(B&&p(B),!k.isLeaf){if(!K.has(k.key))x.add(k.key);else if(B){let a=!0;for(const s of B)if(!x.has(s.key)){a=!1;break}a?T.add(k.key):T.delete(k.key)}}S.pop()})}return p(l),K}function b(h){return d.value.has(h.key)}return{hiddenExpandIconKeySet:d,hiddenNodeKeySet:o,doFilter:v,isForceHiddenExpandIcon:b}}function Ot(e,n){const o=A(new Set),d=A(),i=ut(),v=A(),{isIndeterminate:b,isChecked:h,toggleCheckbox:f,getCheckedKeys:K,getCheckedNodes:T,getHalfCheckedKeys:x,getHalfCheckedNodes:S,setChecked:l,setCheckedKeys:C}=Lt(e,i),{doFilter:p,hiddenNodeKeySet:E,isForceHiddenExpandIcon:k}=Mt(e,i),B=$(()=>{var t;return((t=e.props)==null?void 0:t.value)||ne.KEY}),a=$(()=>{var t;return((t=e.props)==null?void 0:t.children)||ne.CHILDREN}),s=$(()=>{var t;return((t=e.props)==null?void 0:t.disabled)||ne.DISABLED}),u=$(()=>{var t;return((t=e.props)==null?void 0:t.label)||ne.LABEL}),y=$(()=>{var t;const c=o.value,N=E.value,M=[],m=((t=i.value)==null?void 0:t.treeNodes)||[],z=[];for(let O=m.length-1;O>=0;--O)z.push(m[O]);for(;z.length;){const O=z.pop();if(!N.has(O.key)&&(M.push(O),O.children&&c.has(O.key)))for(let I=O.children.length-1;I>=0;--I)z.push(O.children[I])}return M}),g=$(()=>y.value.length>0);function D(t){const c=new Map,N=new Map;let M=1;function m(O,I=1,Qe=void 0){var we;const _e=[];for(const Z of O){const Ce=L(Z),F={level:I,key:Ce,data:Z};F.label=W(Z),F.parent=Qe;const ee=P(Z);F.disabled=R(Z),F.isLeaf=!ee||ee.length===0,F.expanded=o.value.has(Ce),ee&&ee.length&&(F.children=m(ee,I+1,F)),_e.push(F),c.set(Ce,F),N.has(I)||N.set(I,[]),(we=N.get(I))==null||we.push(F)}return I>M&&(M=I),_e}const z=m(t);return{treeNodeMap:c,levelTreeNodeMap:N,maxLevel:M,treeNodes:z}}function w(t){const c=p(t);c&&(o.value=c)}function P(t){return t[a.value]}function L(t){return t?t[B.value]:""}function R(t){return t[s.value]}function W(t){return t[u.value]}function q(t){o.value.has(t.key)?de(t):le(t)}function ue(t){const c=new Set,N=i.value.treeNodeMap;o.value.forEach(M=>{const m=N.get(M);o.value.delete(m.key),m.expanded=!1}),t.forEach(M=>{let m=N.get(M);for(;m&&!c.has(m.key);)c.add(m.key),m.expanded=!0,m=m.parent}),o.value=c}function he(t,c){n(ze,t.data,t,c),ke(t),e.expandOnClickNode&&q(t),e.showCheckbox&&(e.checkOnClickNode||t.isLeaf&&e.checkOnClickLeaf)&&!t.disabled&&f(t,!h(t),!0)}function fe(t,c){n(Fe,t.data,t,c)}function ke(t){pe(t)||(d.value=t.key,n(Ue,t.data,t))}function ye(t,c){f(t,c)}function le(t){const c=o.value;if(i.value&&e.accordion){const{treeNodeMap:M}=i.value;c.forEach(m=>{const z=M.get(m);t&&t.level===(z==null?void 0:z.level)&&(c.delete(m),z.expanded=!1)})}c.add(t.key);const N=se(t.key);N&&(N.expanded=!0,n($e,N.data,N))}function de(t){o.value.delete(t.key);const c=se(t.key);c&&(c.expanded=!1,n(je,c.data,c))}function j(t){return!!t.disabled}function pe(t){const c=d.value;return c!==void 0&&c===t.key}function _(){var t,c;if(d.value)return(c=(t=i.value)==null?void 0:t.treeNodeMap.get(d.value))==null?void 0:c.data}function V(){return d.value}function ve(t){d.value=t}function Se(t){i.value=D(t)}function se(t){var c;const N=ht(t)?L(t):t;return(c=i.value)==null?void 0:c.treeNodeMap.get(N)}function Ge(t,c="auto"){const N=se(t);N&&v.value&&v.value.scrollToItem(y.value.indexOf(N),c)}function Je(t){var c;(c=v.value)==null||c.scrollTo(t)}return ae(()=>e.currentNodeKey,t=>{d.value=t},{immediate:!0}),ae(()=>e.defaultExpandedKeys,t=>{o.value=new Set(t)},{immediate:!0}),ae(()=>e.data,t=>{Se(t)},{immediate:!0}),{tree:i,flattenTree:y,isNotEmpty:g,listRef:v,getKey:L,getChildren:P,toggleExpand:q,toggleCheckbox:f,isChecked:h,isIndeterminate:b,isDisabled:j,isCurrent:pe,isForceHiddenExpandIcon:k,handleNodeClick:he,handleNodeDrop:fe,handleNodeCheck:ye,getCurrentNode:_,getCurrentKey:V,setCurrentKey:ve,getCheckedKeys:K,getCheckedNodes:T,getHalfCheckedKeys:x,getHalfCheckedNodes:S,setChecked:l,setCheckedKeys:C,filter:w,setData:Se,getNode:se,expandNode:le,collapseNode:de,setExpandedKeys:ue,scrollToNode:Ge,scrollTo:Je}}var It=Q({name:"ElTreeNodeContent",props:_t,setup(e){const n=Pe(De),o=Ee("tree");return()=>{const d=e.node,{data:i}=d;return n!=null&&n.ctx.slots.default?n.ctx.slots.default({node:d,data:i}):ft(Kt,{tag:"span",truncated:!0,class:o.be("node","label")},()=>[d==null?void 0:d.label])}}});const At=Q({name:"ElTreeNode"}),Ht=Q(re(ce({},At),{props:wt,emits:Bt,setup(e,{emit:n}){const o=e,d=Pe(De),i=Ee("tree"),v=$(()=>{var l;return(l=d==null?void 0:d.props.indent)!=null?l:16}),b=$(()=>{var l;return(l=d==null?void 0:d.props.icon)!=null?l:ot}),h=l=>{const C=d==null?void 0:d.props.props.class;if(!C)return{};let p;if(He(C)){const{data:E}=l;p=C(E,l)}else p=C;return pt(p)?{[p]:!0}:p},f=l=>{n("click",o.node,l)},K=l=>{n("drop",o.node,l)},T=()=>{n("toggle",o.node)},x=l=>{n("check",o.node,l)},S=l=>{var C,p,E,k;(E=(p=(C=d==null?void 0:d.instance)==null?void 0:C.vnode)==null?void 0:p.props)!=null&&E.onNodeContextmenu&&(l.stopPropagation(),l.preventDefault()),d==null||d.ctx.emit(Ye,l,(k=o.node)==null?void 0:k.data,o.node)};return(l,C)=>{var p,E,k;return H(),oe("div",{ref:"node$",class:J([r(i).b("node"),r(i).is("expanded",l.expanded),r(i).is("current",l.current),r(i).is("focusable",!l.disabled),r(i).is("checked",!l.disabled&&l.checked),h(l.node)]),role:"treeitem",tabindex:"-1","aria-expanded":l.expanded,"aria-disabled":l.disabled,"aria-checked":l.checked,"data-key":(p=l.node)==null?void 0:p.key,onClick:X(f,["stop"]),onContextmenu:S,onDragover:X(()=>{},["prevent"]),onDragenter:X(()=>{},["prevent"]),onDrop:X(K,["stop"])},[Y("div",{class:J(r(i).be("node","content")),style:Re({paddingLeft:`${(l.node.level-1)*r(v)}px`,height:l.itemSize+"px"})},[r(b)?(H(),G(r(lt),{key:0,class:J([r(i).is("leaf",!!((E=l.node)!=null&&E.isLeaf)),r(i).is("hidden",l.hiddenExpandIcon),{expanded:!((k=l.node)!=null&&k.isLeaf)&&l.expanded},r(i).be("node","expand-icon")]),onClick:X(T,["stop"])},{default:xe(()=>[(H(),G(yt(r(b))))]),_:1},8,["class","onClick"])):Ne("v-if",!0),l.showCheckbox?(H(),G(r(bt),{key:1,"model-value":l.checked,indeterminate:l.indeterminate,disabled:l.disabled,onChange:x,onClick:X(()=>{},["stop"])},null,8,["model-value","indeterminate","disabled","onClick"])):Ne("v-if",!0),kt(r(It),{node:re(ce({},l.node),{expanded:l.expanded})},null,8,["node"])],6)],42,["aria-expanded","aria-disabled","aria-checked","data-key","onClick","onDragover","onDragenter","onDrop"])}}}));var Pt=Ie(Ht,[["__file","tree-node.vue"]]);const Rt=Q({name:"ElTreeV2"}),Vt=Q(re(ce({},Rt),{props:St,emits:Tt,setup(e,{expose:n,emit:o}){const d=e,i=vt(),v=$(()=>d.itemSize);Me(De,{ctx:{emit:o,slots:i},props:d,instance:Ae()}),Me(xt,void 0);const{t:b}=dt(),h=Ee("tree"),{flattenTree:f,isNotEmpty:K,listRef:T,toggleExpand:x,isIndeterminate:S,isChecked:l,isDisabled:C,isCurrent:p,isForceHiddenExpandIcon:E,handleNodeClick:k,handleNodeDrop:B,handleNodeCheck:a,toggleCheckbox:s,getCurrentNode:u,getCurrentKey:y,setCurrentKey:g,getCheckedKeys:D,getCheckedNodes:w,getHalfCheckedKeys:P,getHalfCheckedNodes:L,setChecked:R,setCheckedKeys:W,filter:q,setData:ue,getNode:he,expandNode:fe,collapseNode:ke,setExpandedKeys:ye,scrollToNode:le,scrollTo:de}=Ot(d,o);return n({toggleCheckbox:s,getCurrentNode:u,getCurrentKey:y,setCurrentKey:g,getCheckedKeys:D,getCheckedNodes:w,getHalfCheckedKeys:P,getHalfCheckedNodes:L,setChecked:R,setCheckedKeys:W,filter:q,setData:ue,getNode:he,expandNode:fe,collapseNode:ke,setExpandedKeys:ye,scrollToNode:le,scrollTo:de}),(j,pe)=>(H(),oe("div",{class:J([r(h).b(),{[r(h).m("highlight-current")]:j.highlightCurrent}]),role:"tree"},[r(K)?(H(),G(r(Et),{key:0,ref_key:"listRef",ref:T,"class-name":r(h).b("virtual-list"),data:r(f),total:r(f).length,height:j.height,"item-size":r(v),"perf-mode":j.perfMode,"scrollbar-always-on":j.scrollbarAlwaysOn},{default:xe(({data:_,index:V,style:ve})=>[(H(),G(Pt,{key:_[V].key,style:Re(ve),node:_[V],expanded:_[V].expanded,"show-checkbox":j.showCheckbox,checked:r(l)(_[V]),indeterminate:r(S)(_[V]),"item-size":r(v),disabled:r(C)(_[V]),current:r(p)(_[V]),"hidden-expand-icon":r(E)(_[V]),onClick:r(k),onToggle:r(x),onCheck:r(a),onDrop:r(B)},null,8,["style","node","expanded","show-checkbox","checked","indeterminate","item-size","disabled","current","hidden-expand-icon","onClick","onToggle","onCheck","onDrop"]))]),_:1},8,["class-name","data","total","height","item-size","perf-mode","scrollbar-always-on"])):(H(),oe("div",{key:1,class:J(r(h).e("empty-block"))},[Ct(j.$slots,"empty",{},()=>{var _;return[Y("span",{class:J(r(h).e("empty-text"))},me((_=j.emptyText)!=null?_:r(b)("el.tree.emptyText")),3)]})],2))],2))}}));var zt=Ie(Vt,[["__file","tree.vue"]]);const Ft=st(zt),$t={class:"tree-select"},jt={class:"tree-wrapper"},Ut={class:"tree-node"},qt={class:"node-label"},Xt={key:0,class:"node-count"},Yt=Q({__name:"Tree",props:{dataUrl:{type:String,required:!0},modelValue:{type:Array,default:()=>[]},nodeKey:{type:String,default:"id"},defaultProps:{type:Object,default:()=>({children:"children",label:"label"})},defaultExpandAll:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!1},height:{type:Number,default:200},showCount:{type:Boolean,default:!0},showSelected:{type:Boolean,default:!0},loadingText:{type:String,default:ge("message.loading")}},emits:["update:modelValue","change","check"],setup(e,{expose:n,emit:o}){const d=e,i=o,v=A([]),b=A(!1),h=A(),f=A(new Map);ae([()=>d.modelValue,()=>v.value],([a,s])=>{const u=a||[];s&&s.length>0&&ie(()=>{h.value&&h.value.setCheckedKeys(u)})},{immediate:!0,deep:!0});const K=(a,s)=>{var u;return a?(u=s[d.defaultProps.label])==null?void 0:u.toString().includes(a):!0},T=(a,s)=>{const u=s.checkedKeys;i("update:modelValue",u),i("change",u),i("check",{checkedNodes:s.checkedNodes,checkedKeys:u,halfCheckedNodes:s.halfCheckedNodes,halfCheckedKeys:s.halfCheckedKeys})},x=a=>{a.forEach(s=>{f.value.set(s[d.nodeKey],s),s[d.defaultProps.children]&&x(s[d.defaultProps.children])})},S=()=>Le(null,null,function*(){if(d.dataUrl){b.value=!0;try{const a=yield ct.get(d.dataUrl);v.value=a.data,f.value.clear(),x(a.data),d.modelValue&&d.modelValue.length>0&&ie(()=>{h.value&&h.value.setCheckedKeys(d.modelValue)})}catch(a){console.error("get data error:",a),rt.error(ge("message.getDataError"))}finally{b.value=!1}}});return n({getCheckedNodes:()=>{var a;return((a=h.value)==null?void 0:a.getCheckedNodes())||[]},getCheckedLeafNodes:()=>{var a;return((a=h.value)==null?void 0:a.getCheckedNodes(!0))||[]},getHalfCheckedNodes:()=>{var a;return((a=h.value)==null?void 0:a.getHalfCheckedNodes())||[]},clearChecked:()=>{var a;(a=h.value)==null||a.setCheckedKeys([])},setCheckedKeys:a=>{var s;(s=h.value)==null||s.setCheckedKeys(a)},getNodeByKey:a=>f.value.get(a),refresh:S}),gt(()=>{S()}),(a,s)=>{const u=Nt("loading");return H(),oe("div",$t,[s[0]||(s[0]=Y("div",{class:"tree-header"},null,-1)),Y("div",jt,[mt((H(),G(r(Ft),{ref_key:"treeRef",ref:h,data:v.value,props:e.defaultProps,"node-key":e.nodeKey,"default-expand-all":e.defaultExpandAll,"filter-node-method":K,"highlight-current":!0,"show-checkbox":"","check-strictly":e.checkStrictly,height:e.height,onCheck:T,"element-loading-text":e.loadingText},{default:xe(({node:y,data:g})=>[Y("span",Ut,[Y("span",qt,me(r(ge)(y.label)),1),e.showCount&&g[e.defaultProps.children]?(H(),oe("span",Xt," ("+me(g[e.defaultProps.children].length)+") ",1)):Ne("",!0)])]),_:1},8,["data","props","node-key","default-expand-all","check-strictly","height","element-loading-text"])),[[u,b.value]])])])}}}),sn=it(Yt,[["__scopeId","data-v-2d6fa8d5"]]);export{sn as T};
