import{T as w,a1 as I,V as S,Z as A,R as i,$ as n,_ as E}from"./bootstrap-Bf65uz2I.js";import{E as V}from"./el-image-viewer-DlaFkWIK.js";import"./css-BA5xAVBz.js";import{E as k}from"./index-e0qsk5Ci.js";import{k as T,r as u,w as b,B as r,n as l,E as m,u as t,J as z}from"../jse/index-index-D3Xb8oT_.js";const B={VITE_GLOB_API_URL:"http://pro.api.aiflowy.tech"},L=T({__name:"UploadAvatar",props:{action:{type:String,default:"/api/v1/commons/upload"},fileSize:{type:Number,default:2},allowedImageTypes:{type:Array,default:()=>["image/gif","image/jpeg","image/png","image/webp"]},modelValue:{type:String,default:""}},emits:["success","update:modelValue"],setup(d,{emit:f}){const a=d,c=f,_=w(),v=u({"aiflowy-token":_.accessToken}),{apiURL:g}=I(B,!0),s=u(a.modelValue),y=(e,o)=>{s.value=URL.createObjectURL(o.raw),c("success",e.data.path),c("update:modelValue",e.data.path)};b(()=>a.modelValue,e=>{s.value=e},{immediate:!0});const h=e=>{if(a.allowedImageTypes.includes(e.type)){if(e.size/1024/1024>a.fileSize)return i.error(n("cropper.message.avatarSize",{limit:a.fileSize})),!1}else{const o=a.allowedImageTypes.map(U=>{const p=U.split("/");return p[1]?p[1].toUpperCase():""}).filter(Boolean);return i.error(n("cropper.message.avatarFormat",{format:o.join(", ")})),!1}return!0};return(e,o)=>(l(),r(t(k),{class:"avatar-uploader",action:`${t(g)}${a.action}`,headers:v.value,"show-file-list":!1,"on-success":y,"before-upload":h},{default:m(()=>[s.value?(l(),r(t(V),{key:0,src:s.value,class:"avatar",fit:"cover"},null,8,["src"])):(l(),r(t(S),{key:1,class:"avatar-uploader-icon"},{default:m(()=>[z(t(A))]),_:1}))]),_:1},8,["action","headers"]))}}),N=E(L,[["__scopeId","data-v-002edfda"]]);export{N as U};
