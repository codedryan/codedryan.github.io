var m=(i,u,t)=>new Promise((r,n)=>{var c=e=>{try{s(t.next(e))}catch(o){n(o)}},a=e=>{try{s(t.throw(e))}catch(o){n(o)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(c,a);s((t=t.apply(i,u)).next())});import{av as y,aw as _,X as w,ax as x,ay as A,$ as l,M as S,R as k}from"./bootstrap-Bf65uz2I.js";import{C as B}from"./Cropper-B2gqAGf7.js";import{k as b,G as C,c as v,m as I,n as g,J as d,u as f,E as N,L as F,y as D,r as p,S as L,o as M,H as R,I as V,B as $}from"../jse/index-index-D3Xb8oT_.js";const E=["onKeydown"],K=b({__name:"base-setting",props:{formSchema:{default:()=>[]},buttonText:{default:"更新基本信息"},buttonLoading:{type:Boolean,default:!1}},emits:["submit"],setup(i,{expose:u,emit:t}){const r=i,n=t,[c,a]=y(C({commonConfig:{componentProps:{class:"w-full"}},layout:"vertical",schema:v(()=>r.formSchema),showDefaultActions:!1}));function s(){return m(this,null,function*(){const{valid:e}=yield a.validate(),o=yield a.getValues();e&&n("submit",o)})}return u({getFormApi:()=>a}),(e,o)=>(g(),I("div",{class:"mx-auto max-w-[360px] pt-12",onKeydown:w(x(s,["prevent"]),["enter"])},[d(f(c)),d(f(_),{loading:i.buttonLoading,type:"submit",class:"mx-auto mt-4 block h-8 w-[106px] p-0",onClick:s},{default:N(()=>[F(D(i.buttonText),1)]),_:1},8,["loading"])],40,E))}}),J=b({__name:"base-setting",setup(i){const{fetchUserInfo:u}=A(),t=p(),r=v(()=>[{fieldName:"avatar",component:L(B),componentProps:{crop:!0},label:l("sysAccount.avatar")},{fieldName:"nickname",component:"Input",label:l("sysAccount.nickname")},{fieldName:"mobile",component:"Input",label:l("sysAccount.mobile")},{fieldName:"email",component:"Input",label:l("sysAccount.email")}]);M(()=>m(null,null,function*(){yield n()}));function n(){return m(this,null,function*(){c.value=!0;const e=yield u();yield t.value.getFormApi().setValues(e),c.value=!1})}const c=p(!1),a=p(!1);function s(e){a.value=!0,S.post("/api/v1/sysAccount/updateProfile",e).then(o=>{a.value=!1,o.errorCode===0&&(k.success(l("message.success")),n())})}return(e,o)=>{const h=R("loading");return V((g(),$(f(K),{"button-loading":a.value,ref_key:"profileBaseSettingRef",ref:t,"form-schema":r.value,"button-text":f(l)("button.update"),onSubmit:s},null,8,["button-loading","form-schema","button-text"])),[[h,c.value]])}}});export{J as _};
