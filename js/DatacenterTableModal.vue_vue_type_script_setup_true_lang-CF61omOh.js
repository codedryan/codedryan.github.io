var W=Object.defineProperty,X=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var w=(m,u,s)=>u in m?W(m,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[u]=s,$=(m,u)=>{for(var s in u||(u={}))le.call(u,s)&&w(m,s,u[s]);if(I)for(var s of I(u))ae.call(u,s)&&w(m,s,u[s]);return m},z=(m,u)=>X(m,ee(u));import{$ as t,M as T,V as te,Z as oe,R as O}from"./bootstrap-Bf65uz2I.js";import"./css-gf8D6QlL.js";import{E as de}from"./el-dialog-CAR1-R4U.js";import"./el-overlay-Zuw8glOl.js";/* empty css                */import{E as ie,a as M}from"./el-form-item-8FQp7Cs4.js";import"./css-C9o_OfXA.js";import{E as re}from"./el-message-box-B8o3mhYx.js";/* empty css                  *//* empty css               *//* empty css                     *//* empty css                  */import{E as ue,a as g}from"./el-table-JPhh2aff.js";import"./css-_QzOlLq8.js";/* empty css                   *//* empty css                        */import{ElInput as E}from"./index-BjDsryRX.js";import{E as L,a as R}from"./index-DcZY4wgD.js";import{ElButton as D}from"./index-oBOAcXl-.js";import{k as se,o as ne,r as n,w as me,H as fe,B as U,n as b,E as i,J as o,u as e,I as ce,m as C,q as pe,F as S,N as A,L as y,y as N}from"../jse/index-index-D3Xb8oT_.js";const be={class:"w-full"},ve={class:"mt-3"},Le=se({__name:"DatacenterTableModal",emits:["reload"],setup(m,{expose:u,emit:s}){const j=s;ne(()=>{P(),Q()}),u({openDialog:K});const h=n(),_=n(!1),V=n(!0),c=n({deptId:"",tableName:"",tableDesc:"",actualTable:"",status:"",options:""}),v=n(!1),H=n({tableName:[{required:!0,message:t("message.required"),trigger:"blur"},{pattern:/^[a-z][a-z0-9_]*$/,message:t("datacenterTable.nameRegx")}],fields:[{required:!0,validator:(a,r,f)=>{!r||r.length===0?f(new Error(t("datacenterTable.noFieldError"))):(r.forEach(l=>{(!l.fieldName||!l.fieldDesc)&&f(new Error(t("datacenterTable.fieldInfoError"))),/^[a-z][a-z0-9_]*$/.test(l.fieldName)||f(new Error(t("datacenterTable.nameRegx")))}),f())},trigger:"blur"}]}),p=n(),F=n([]),k=n(!1),q=n([]),B=n([]);me(()=>p.value,a=>{c.value.fields=a},{deep:!0});function J(a){k.value=!0,T.get(`/api/v1/datacenterTable/detailInfo?tableId=${a}`).then(r=>{k.value=!1,p.value=r.data.fields})}function K(a){p.value=[],F.value=[],a.id&&(J(a.id),V.value=!1),c.value=a,_.value=!0}function Y(){var a;(a=h.value)==null||a.validate(r=>{if(r){if(p.value.length===0){O.error(t("message.required"));return}const f=z($({},c.value),{fields:[...p.value,...F.value]});v.value=!0,T.post("/api/v1/datacenterTable/saveTable",f).then(l=>{v.value=!1,l.errorCode===0&&(O.success(l.message),j("reload"),x())}).catch(()=>{v.value=!1})}})}function x(){var a;(a=h.value)==null||a.resetFields(),V.value=!0,c.value={},_.value=!1}function Z(){p.value.push({fieldName:"",fieldDesc:"",fieldType:1,required:0,handleDelete:!1,rowKey:Date.now().toString()})}function G(a,r){re.confirm(t("message.deleteAlert"),t("message.noticeTitle"),{confirmButtonText:t("message.ok"),cancelButtonText:t("message.cancel"),type:"warning",beforeClose:(f,l,d)=>{f==="confirm"&&(a.id&&(a.handleDelete=!0,F.value.push(a)),p.value.splice(r,1)),d()}}).catch(()=>{})}function P(){T.get("/api/v1/dict/items/fieldType").then(a=>{q.value=a.data})}function Q(){T.get("/api/v1/dict/items/yesOrNo").then(a=>{B.value=a.data})}return(a,r)=>{const f=fe("loading");return b(),U(e(de),{modelValue:_.value,"onUpdate:modelValue":r[2]||(r[2]=l=>_.value=l),draggable:"",title:V.value?e(t)("button.add"):e(t)("button.edit"),"before-close":x,"close-on-click-modal":!1,width:"800px"},{footer:i(()=>[o(e(D),{onClick:x},{default:i(()=>[y(N(e(t)("button.cancel")),1)]),_:1}),o(e(D),{type:"primary",onClick:Y,loading:v.value,disabled:v.value},{default:i(()=>[y(N(e(t)("button.save")),1)]),_:1},8,["loading","disabled"])]),default:i(()=>[o(e(ie),{"label-width":"100px",ref_key:"saveForm",ref:h,model:c.value,"status-icon":"",rules:H.value},{default:i(()=>[o(e(M),{prop:"tableName",label:e(t)("datacenterTable.tableName")},{default:i(()=>[o(e(E),{disabled:!V.value,modelValue:c.value.tableName,"onUpdate:modelValue":r[0]||(r[0]=l=>c.value.tableName=l),modelModifiers:{trim:!0}},null,8,["disabled","modelValue"])]),_:1},8,["label"]),o(e(M),{prop:"tableDesc",label:e(t)("datacenterTable.tableDesc")},{default:i(()=>[o(e(E),{modelValue:c.value.tableDesc,"onUpdate:modelValue":r[1]||(r[1]=l=>c.value.tableDesc=l),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1},8,["label"]),o(e(M),{prop:"fields","label-width":"0"},{default:i(()=>[ce((b(),C("div",be,[o(e(ue),{data:p.value},{default:i(()=>[o(e(g),{label:e(t)("datacenterTable.fieldName")},{default:i(({row:l})=>[o(e(E),{modelValue:l.fieldName,"onUpdate:modelValue":d=>l.fieldName=d,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),o(e(g),{label:e(t)("datacenterTable.fieldDesc")},{default:i(({row:l})=>[o(e(E),{modelValue:l.fieldDesc,"onUpdate:modelValue":d=>l.fieldDesc=d,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),o(e(g),{label:e(t)("datacenterTable.fieldType")},{default:i(({row:l})=>[o(e(L),{modelValue:l.fieldType,"onUpdate:modelValue":d=>l.fieldType=d,modelModifiers:{trim:!0},disabled:!!l.id},{default:i(()=>[(b(!0),C(S,null,A(q.value,d=>(b(),U(e(R),{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","disabled"])]),_:1},8,["label"]),o(e(g),{label:e(t)("datacenterTable.required")},{default:i(({row:l})=>[o(e(L),{modelValue:l.required,"onUpdate:modelValue":d=>l.required=d,modelModifiers:{trim:!0}},{default:i(()=>[(b(!0),C(S,null,A(B.value,d=>(b(),U(e(R),{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),o(e(g),{label:e(t)("common.handle"),width:"80"},{default:i(({row:l,$index:d})=>[o(e(D),{link:"",type:"danger",onClick:ge=>G(l,d)},{default:i(()=>[y(N(e(t)("button.delete")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),pe("div",ve,[o(e(D),{plain:"",type:"primary",onClick:Z},{default:i(()=>[o(e(te),{class:"mr-1"},{default:i(()=>[o(e(oe))]),_:1}),y(" "+N(e(t)("button.add")),1)]),_:1})])])),[[f,k.value]])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});export{Le as _};
