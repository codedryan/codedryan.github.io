var C=Object.defineProperty;var _=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var x=(n,t,a)=>t in n?C(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,F=(n,t)=>{for(var a in t||(t={}))S.call(t,a)&&x(n,a,t[a]);if(_)for(var a of _(t))A.call(t,a)&&x(n,a,t[a]);return n};import{M as p,a2 as B,$ as D}from"./bootstrap-Bf65uz2I.js";import"./css-gf8D6QlL.js";/* empty css                */import{E as N,a as V}from"./el-form-item-8FQp7Cs4.js";import{_ as $}from"./WorkflowFormItem.vue_vue_type_script_setup_true_lang-Cr5clR5Y.js";import{ElButton as L}from"./index-oBOAcXl-.js";import{k as U,r as u,c as J,a as M,m as T,n as W,J as d,u as i,E as v,L as j,y as q}from"../jse/index-index-D3Xb8oT_.js";const Y=U({__name:"WorkflowForm",props:{onAsyncExecute:{type:Function,default:()=>{console.warn("no async execute method")}},onSubmit:{type:Function,default:()=>{console.warn("no submit method")}},tinyFlowData:{},workflowId:{},workflowParams:{}},setup(n,{expose:t}){const a=n;t({resume:b});const w=u(),l=u({}),m=u(!1),I=J(()=>a.workflowParams.parameters),f=u("");function b(e){e.executeId=f.value,m.value=!0,p.post("/api/v1/workflow/resume",e).then(o=>{o.errorCode===0&&k(f.value)})}function g(){var e;(e=w.value)==null||e.validate(o=>{var r;if(o){const h={id:a.workflowId,variables:F({},l.value)};(r=a.onSubmit)==null||r.call(a,l.value),m.value=!0,p.post("/api/v1/workflow/runAsync",h).then(c=>{c.errorCode===0&&c.data&&(f.value=c.data,k(c.data))})}})}const s=u(),E=u(a.tinyFlowData.nodes.map(e=>({nodeId:e.id,nodeName:e.data.title})));function k(e){s.value||(s.value=setInterval(()=>P(e),1e3))}function P(e){p.post("/api/v1/workflow/getChainStatus",{executeId:e,nodes:E.value}).then(o=>{var r;(o.data.status!==1||o.data.status===5)&&y(),(r=a.onAsyncExecute)==null||r.call(a,o.data)})}function y(){m.value=!1,s.value&&(clearInterval(s.value),s.value=null)}return M(()=>{y()}),(e,o)=>(W(),T("div",null,[d(i(N),{"label-position":"top",ref_key:"runForm",ref:w,model:l.value},{default:v(()=>[d($,{"run-params":l.value,"onUpdate:runParams":o[0]||(o[0]=r=>l.value=r),parameters:I.value},null,8,["run-params","parameters"]),d(i(V),null,{default:v(()=>[d(i(L),{type:"primary",onClick:g,loading:m.value,icon:i(B)},{default:v(()=>[j(q(i(D)("button.run")),1)]),_:1},8,["loading","icon"])]),_:1})]),_:1},8,["model"])]))}});export{Y as _};
