var A=(j,F,k)=>new Promise((f,m)=>{var w=c=>{try{p(k.next(c))}catch(h){m(h)}},C=c=>{try{p(k.throw(c))}catch(h){m(h)}},p=c=>c.done?f(c.value):Promise.resolve(c.value).then(w,C);p((k=k.apply(j,F)).next())});import{as as Y,aI as Q,aL as tt,$ as r,Z as et,bP as st,V as at,M as E,R as D,_ as ot}from"./bootstrap-Bf65uz2I.js";import"./css-gf8D6QlL.js";import{E as U}from"./el-card-DGd_zL6P.js";import{E as rt}from"./el-empty-CDAlv280.js";import"./css-C9o_OfXA.js";import{D as lt}from"./DictSelect-DdOvS-6R.js";import{T as nt}from"./Tag-BLqYdY0p.js";import{u as it}from"./dict-CsbZy8Qf.js";import{ElButton as S}from"./index-oBOAcXl-.js";import{ElInput as O}from"./index-BjDsryRX.js";import{k as dt,r as g,o as ct,c as ut,m as i,n as l,J as u,q as t,E as v,u as e,L as _,y as a,F as L,N as T,s as V,p as y,B as pt}from"../jse/index-index-D3Xb8oT_.js";import"./index-Bxb6QITi.js";/* empty css                  *//* empty css               *//* empty css                     *//* empty css                  */import"./index-DcZY4wgD.js";import"./index-CMBjNRIa.js";import"./index-bT9OJj6t.js";import"./_overRest-Bb9G3v08.js";import"./index-B3qAv2kq.js";import"./aria-DEUWDJ1E.js";import"./use-form-common-props-IzjzSHax.js";import"./index-CbSmxnRE.js";import"./util-B2mB0_6C.js";import"./index-DGdiZ7pE.js";import"./useProps-DNCnrLfW.js";import"./_baseFindIndex-D7XfJLKM.js";import"./_baseIteratee-rJjBrWyx.js";import"./strings-CGsg9AfI.js";import"./castArray-BBset58W.js";import"./use-form-item-DVWmmqeW.js";import"./index-m1ZP1zbM.js";import"./event-BB_Ol6Sd.js";import"./scroll-C2492Iw_.js";import"./clamp-CeuJyDnc.js";import"./toNumber-CvayJyp9.js";import"./index-pv0R11Cf.js";import"./vnode-DysYOGZN.js";import"./index-Dg3fRnQE.js";import"./index-C33Sf0pH.js";const mt={class:"flex h-full flex-col gap-4 p-6"},vt={class:"flex items-center gap-4"},_t={class:"mt-4 grid grid-cols-5 gap-4 rounded-lg border border-[var(--el-border-color)] bg-white p-4"},ft={class:"flex flex-col gap-1"},xt={class:"text-xs text-gray-500"},kt={class:"text-sm font-medium"},ht={class:"flex flex-col gap-1"},bt={class:"text-xs text-gray-500"},gt={class:"text-sm font-medium"},yt={class:"flex flex-col gap-1"},wt={class:"text-xs text-gray-500"},Ct={class:"text-sm font-medium"},Mt={class:"flex flex-col gap-1"},It={class:"text-xs text-gray-500"},Dt={class:"text-sm font-semibold text-blue-600"},St={class:"flex flex-col gap-1"},Et={class:"text-xs text-gray-500"},Vt={class:"text-sm font-medium"},Ft={class:"flex flex-1 gap-4 overflow-hidden"},Nt={class:"flex w-64 flex-col gap-2 overflow-hidden rounded-lg border border-[var(--el-border-color)] bg-[var(--el-bg-color)]"},At={class:"border-b border-[var(--el-border-color)] p-3 font-medium"},Lt={class:"flex-1 overflow-auto p-2"},Tt=["onClick"],$t={class:"flex flex-1 flex-col gap-4 overflow-hidden rounded-lg border border-[var(--el-border-color)] bg-[var(--el-bg-color)] p-4"},jt={class:"border-b border-[var(--el-border-color)] pb-3"},qt={class:"text-lg font-medium"},Bt={class:"mt-1 text-sm text-gray-500"},Jt={class:"flex-1 overflow-auto px-2"},Qt={key:0,class:"text-sm text-[#333]"},Ut={key:1,class:"text-sm text-[#333]"},Ot={class:"mt-2 text-center text-xs text-[#999]"},zt={key:1,class:"mt-1"},Pt={class:"flex w-96 flex-col gap-4 overflow-hidden rounded-lg border border-[var(--el-border-color)] bg-[var(--el-bg-color)] p-4"},Rt={class:"flex items-center justify-between border-b border-[var(--el-border-color)] pb-3 font-medium"},Kt={key:0},Zt={class:"flex-1 overflow-auto"},Gt={key:0},Ht={key:0,class:"space-y-4"},Wt={class:"mb-3 flex items-center justify-between"},Xt={class:"text-sm font-semibold text-[#333]"},Yt={class:"space-y-3"},te={class:"mb-1 block text-xs text-[#666]"},ee={class:"mb-1 block text-xs text-[#666]"},se={class:"mb-1 block text-xs text-[#666]"},ae={key:0,class:"flex justify-end"},oe={key:1},re={class:"font-medium"},le={class:"display-div"},ne={class:"display-div"},ie={class:"display-div"},de=dt({__name:"DataMarkDetail",setup(j){const F=Y(),k=F.query.type,f=g(F.query.id),m=g({}),w=g([]),C=g(""),p=g(null),c=g([]),h=g([]),$=g(!1),z=()=>A(null,null,function*(){try{const o=yield E.get("/api/v1/markTask/detail",{params:{id:f.value}});o.data&&(m.value=o.data)}catch(o){console.error("加载任务信息失败:",o),D.error(r("message.loadTaskFail"))}}),q=()=>A(null,null,function*(){if(f.value)try{const o=yield E.get("/api/v1/markConversation/list",{params:{taskId:f.value}});o.data&&Array.isArray(o.data)&&(w.value=o.data,w.value.length>0&&B(w.value[0]))}catch(o){console.error("加载会话列表失败:",o),D.error(r("message.loadSessionFail"))}}),B=o=>{C.value=String(o.id),p.value=o,P(o.conversationId),h.value=[]},P=o=>A(null,null,function*(){try{const n=yield E.get("/api/v1/markConversationMessage/list",{params:{taskId:f.value,conversationId:o,sortKey:"created",sortType:"asc"}});c.value=n.data&&n.data.length>0?n.data:[]}catch(n){console.error("加载对话详情失败:",n),D.error(r("message.loadChatFail"))}}),R=()=>{Q.back()},K=o=>{D.info(`${r("message.viewQA")}：${o.question}`)},M=it();function Z(){M.fetchDictionary("sysAccount"),M.fetchDictionary("markStatus"),M.fetchDictionary("aiDataset")}ct(()=>{f.value=Q.currentRoute.value.query.id,z(),q(),Z()});function G(o){switch(o){case 0:return"info";case 1:return"warning";case 2:return"success";case 3:return"success";default:return"info"}}function H(o){const d=c.value[o-1],I=c.value[o];d.status=1,I.status=1;const N=JSON.parse(d.content),s=JSON.parse(I.content);h.value.push({questionMsgId:d.id,question:N.content,answerMsgId:I.id,answer:s.fullContent,status:1,conversationId:p.value.id,taskId:f.value})}function W(o){$.value=!0,E.post("/api/v1/datasetQa/saveMarkQA",o).then(n=>{$.value=!1,n.errorCode===0&&(o.status=2,D.success(n.message))})}function J(o){const n={id:p.value.id,taskId:f.value,status:o};E.post("/api/v1/markConversation/updateStatus",n).then(d=>{d.errorCode===0&&(D.success(d.message),q())})}const X=ut(()=>{const o=c.value.filter(d=>d.datasetId),n=[];for(let d=0;d<o.length;d+=2)d+1<o.length&&n.push({q:o[d],a:o[d+1]});return n});return(o,n)=>{var d,I,N;return l(),i("div",mt,[u(e(U),{shadow:"never"},{default:v(()=>[t("div",vt,[u(e(S),{icon:e(tt),link:"",onClick:R},{default:v(()=>[_(a(e(r)("dataMark.taskId"))+": "+a(m.value.id),1)]),_:1},8,["icon"])]),t("div",_t,[t("div",ft,[t("span",xt,a(e(r)("dataMark.assistantName")),1),t("span",kt,a(m.value.botName||"-"),1)]),t("div",ht,[t("span",bt,a(e(r)("dataMark.sessionCount")),1),t("span",gt,a(m.value.conversationCount||0),1)]),t("div",yt,[t("span",wt,a(e(r)("dataMark.marker")),1),t("span",Ct,a(e(M).getDictLabel("sysAccount",m.value.markUser)),1)]),t("div",Mt,[t("span",It,a(e(r)("dataMark.taskProgress")),1),t("span",Dt,a(m.value.taskProgress||0),1)]),t("div",St,[t("span",Et,a(e(r)("dataMark.creationTime")),1),t("span",Vt,a(m.value.created||"-"),1)])])]),_:1}),t("div",Ft,[t("div",Nt,[t("div",At,a(e(r)("dataMark.sessionList")),1),t("div",Lt,[(l(!0),i(L,null,T(w.value,s=>(l(),i("div",{key:s.id,class:V(["flex cursor-pointer items-center justify-between rounded-lg p-3 transition-all hover:bg-gray-50",{"bg-[#E6F2FF]":C.value===String(s.id)}]),onClick:x=>B(s)},[t("span",{class:V(["flex-1 truncate text-sm font-medium",{"text-[#1879FF]":C.value===String(s.id),"text-[#333]":C.value!==String(s.id)}])},a(s.title),3),u(nt,{type:G(s.status),text:e(M).getDictLabel("markStatus",s.status)},null,8,["type","text"])],10,Tt))),128))])]),t("div",$t,[t("div",jt,[t("div",qt,a((d=p.value)==null?void 0:d.title),1),t("div",Bt,a(e(r)("dataMark.messagesTotal",{number:c.value.length})),1)]),t("div",Jt,[(l(!0),i(L,null,T(c.value,(s,x)=>(l(),i("div",{key:x,class:"mb-4"},[["user","assistant"].includes(s.role)?(l(),i("div",{key:0,class:V(["flex gap-3",s.role==="user"?"justify-end":"justify-start"])},[t("div",{class:V(["max-w-[70%] rounded-[12px] p-3 shadow-sm",{"border border-[#E0E0E0] bg-white":s.role==="user","bg-[#F0F8FF]":s.role==="assistant"}])},[s.role==="user"?(l(),i("div",Qt,a(JSON.parse(s.content).content),1)):y("",!0),s.role==="assistant"?(l(),i("div",Ut,a(JSON.parse(s.content).fullContent),1)):y("",!0),t("div",Ot,a(s.created),1)],2)],2)):y("",!0),s.role==="assistant"&&s.status===0&&e(k)==="mark"&&[0,1].includes(p.value.status)?(l(),i("div",zt,[u(e(S),{icon:e(et),type:"primary",onClick:b=>H(x)},{default:v(()=>[_(a(e(r)("button.mark")),1)]),_:1},8,["icon","onClick"])])):y("",!0),s.status===2?(l(),i("div",{key:2,class:V(["mt-1 flex items-center gap-1 text-[12px] text-[#969799]",s.role==="user"?"justify-end":"justify-start"])},[u(e(at),{size:"14px"},{default:v(()=>[u(e(st))]),_:1}),_(" "+a(e(r)("dataMark.marked")),1)],2)):y("",!0)]))),128))])]),t("div",Pt,[t("div",Rt,[t("div",null,a(e(r)("button.mark")),1),e(k)==="mark"?(l(),i("div",Kt,[u(e(S),{onClick:n[0]||(n[0]=s=>J(3)),disabled:[2,3].includes((I=p.value)==null?void 0:I.status)},{default:v(()=>[_(a(e(r)("button.noMarkNeeded")),1)]),_:1},8,["disabled"]),u(e(S),{onClick:n[1]||(n[1]=s=>J(2)),disabled:[2,3].includes((N=p.value)==null?void 0:N.status)},{default:v(()=>[_(a(e(r)("button.markCompleted")),1)]),_:1},8,["disabled"])])):y("",!0)]),t("div",Zt,[e(k)==="mark"?(l(),i("div",Gt,[h.value.length>0?(l(),i("div",Ht,[(l(!0),i(L,null,T(h.value,(s,x)=>(l(),i("div",{key:x,class:"rounded-lg border border-[#E0E0E0] bg-white p-4 shadow-sm"},[t("div",Wt,[t("span",Xt," QA"+a(x+1),1),u(e(S),{type:"primary",link:"",size:"small",class:"!text-xs !text-[#1879FF]",onClick:b=>K(s)},{default:v(()=>[_(a(e(r)("button.view")),1)]),_:1},8,["onClick"])]),t("div",Yt,[t("div",null,[t("label",te,a(e(r)("dataMark.dataset")),1),u(lt,{modelValue:s.datasetId,"onUpdate:modelValue":b=>s.datasetId=b,"dict-code":"aiDataset"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",null,[t("label",ee,a(e(r)("dataMark.question")),1),u(e(O),{modelValue:s.question,"onUpdate:modelValue":b=>s.question=b,class:"!rounded-[4px]"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",null,[t("label",se,a(e(r)("dataMark.referenceAnswer")),1),u(e(O),{modelValue:s.answer,"onUpdate:modelValue":b=>s.answer=b,type:"textarea",rows:4,class:"!rounded-[4px]"},null,8,["modelValue","onUpdate:modelValue"])]),s.status===1?(l(),i("div",ae,[u(e(S),{loading:$.value,type:"primary",onClick:b=>W(s)},{default:v(()=>[_(a(e(r)("dataMark.confirmAdd")),1)]),_:1},8,["loading","onClick"])])):y("",!0)])]))),128))])):(l(),pt(e(rt),{key:1,description:e(r)("message.noMark")},null,8,["description"]))])):(l(),i("div",oe,[(l(!0),i(L,null,T(X.value,(s,x)=>(l(),i("div",{key:x},[u(e(U),{shadow:"never",class:"mb-3"},{header:v(()=>[t("div",re,"QA"+a(Number(x)+1),1)]),default:v(()=>[t("div",null,[_(a(e(r)("dataMark.dataset"))+" ",1),t("div",le,a(e(M).getDictLabel("aiDataset",s.q.datasetId)),1)]),t("div",null,[_(a(e(r)("dataMark.question"))+" ",1),t("div",ne,a(JSON.parse(s.q.content).content),1)]),t("div",null,[_(a(e(r)("dataMark.referenceAnswer"))+" ",1),t("div",ie,a(JSON.parse(s.a.content).fullContent),1)])]),_:2},1024)]))),128))]))])])])])}}}),Xe=ot(de,[["__scopeId","data-v-773488ac"]]);export{Xe as default};
